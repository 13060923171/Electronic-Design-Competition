C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 1   


C51 COMPILER V9.00, COMPILATION OF MODULE ¿Ø_ÆÏµÍ³
OBJECT MODULE PLACED IN ¿ØÖÆÏµÍ³.OBJ
COMPILER INVOKED BY: D:\Program Files\keil9.00\C51\BIN\C51.EXE ¿ØÖÆÏµÍ³.c ROM(COMPACT) OPTIMIZE(9,SIZE) BROWSE DEBUG OBJ
                    -ECTEXTEND

line level    source

   1          /**************************************************************************************
   2           ³ÌÐòÃû³Æ£º
   3                     Ê±¼ä ÎÂ¶È¿ØÖÆÏµÍ³£¨128*64LCD+ds1302+ds18b20£©
   4           Ö÷Òª¹¦ÄÜ£º
   5                     ÎÂ¶È¼Æ Ê±ÖÓ ÄÖÁå ÃÜÂëËø ÀºÇòÆ÷ ¼ÆËãÆ÷ ÎÂ¶È¿ØÖÆ ¼üÅÌËø ÏµÍ³ÉèÖÃµÈ¡£
   6           Ö÷ÒªËµÃ÷£º
   7                     ³ÌÐòÈ«²¿¶¨ÒåÔÚÒ»¸öCÎÄ¼þÖÐ¡£
   8           ×÷Õß£º    
   9                     LiJH
  10           Ê±¼ä£º   
  11                     2008.6.20
  12           °æ±¾£º   
  13                     LiJH-V1.0
  14          **************************************************************************************/
  15          #include    <AT89S53.h>
  16          #include    <intrins.h>         
  17          #define     uchar        unsigned char
  18          #define     uint         unsigned int
  19          #define     time_count   0x3cb0
  20          #define     close        1
  21          #define     open         0
  22          
  23          /*============ ×´Ì¬¿ØÖÆ¼°ÎÂ¸ÐÆ÷×ÜÏß¶¨Òå ==============*/ 
  24           
  25          #define     b20_io       P3_4           // DS18B20×ÜÏß    
  26          #define     pw_oc        P3_7           // ÃÜÂëËø¿ªÆô¿ØÖÆ(»ÆµÆ)
  27          #define     buzzer       P3_3           // ·äÃùÆ÷
  28          #define     lcd_bl       P0_6           // ±³¹â¿ØÖÆ¿Ú
  29          #define     als_th       P0_4           // ÉÏÏÞÎÂ¶È¾¯±¨(ºìµÆ)
  30          #define     als_tl       P3_6           // ÏÂÏÞÎÂ¶È¾¯±¨(ÂÌµÆ)
  31          #define     keyboard     P1                     // ¼üÅÌÊý¾Ý¿Ú
  32          
  33          
  34          /*================= ST7920LCD ¶¨Òå ===================*/
  35          
  36          #define     comm         0                      // lcdÖ¸Áî
  37          #define     dat          1                      // lcdÊý¾Ý
  38          #define     lcd_rst      P0_7           // lcd¸´Î»
  39          #define     lcd_e        P3_0           // lcdÊ¹ÄÜ
  40          #define     lcd_rw       P3_1           // lcd¶ÁÐ´
  41          #define     lcd_rs       P3_2           // lcdÊý¾ÝÃüÁî
  42          #define     busy         P2_7       // Ã¦ÂµÎ»
  43          #define     lcd_data     P2                     // lcd(8bit)Êý¾Ý´«Êä 
  44          
  45            
  46          /*=============== DS1302 ¼Ä´æÆ÷µØÖ·¶¨Òå ===============*/
  47          
  48          #define         d02_rst      P0_1               // DS1302Ê¹ÄÜ
  49          #define         d02_data     P0_2               // DS1302Êý¾ÝÏß
  50          #define         d02_sclk     P0_3               // DS1302Âö³å
  51          #define     d02_wrc      0x8e           // 1302¶ÁÐ´RAM¿ØÖÆ(1ÔÊÐí 0½ûÖ¹)
  52          #define     d02_year     0x8c           // Äê
  53          #define     d02_weeks    0x8a           // ÐÇÆÚ
  54          #define     d02_month    0x88           // ÔÂ
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 2   

  55          #define     d02_day              0x86           // ÈÕ
  56          #define     d02_hour     0x84           // Ê±
  57          #define     d02_minute   0x82           // ·Ö
  58          #define     d02_second   0x80           // Ãë
  59          #define     d02_signs    0xc0           // ÏµÍ³×´Ì¬(¼ÇÂ¼ÉèÖÃ±ê¼Ç)
  60          #define     d02_passw    0xc2           // ÃÜÂë¼Ä´æÆ÷Ê×Î»£¨ÓÐ3Î»ÏÂÎ»µØÖ·¼Ó2£¬³õÊ¼ÖµÎª£º741456£©
  61          #define     d02_alm              0xc8           // ÄÖÁåÊ±¼äÐ¡Ê±Î»£¨ÏÂÎ»Îª·ÖÖÓÎ»¼Ó2£©
  62          #define     d02_temp     0xcc           // ÎÂ¶ÈÉÏÏÞ¾¯±¨£¨ÓÐÁ½Î»ÏÂÎ»Î»ÏÂÏÞ¼Ó2£©
  63          #define     d02_initsi   0xd4           // 1302³õÊ¼»¯±ê¼Ç£¨Îª0xb4Ê±£¬ËµÃ÷ÒÑ¾­³õÊ¼»¯£©
  64          #define     ret_ds1302()    d02_rst=0;d02_sclk=0;d02_rst=1      // 1302¶ÁÐ´¸´Î»
  65          #define     end_ds1302()    d02_sclk=1;d02_rst=0                        // 1302¶ÁÐ´½áÊø
  66          
  67          
  68          
  69          /*================================= È«¾Ö±äÁ¿¶¨Òå ==================================*/
  70          
  71          
  72          typedef struct                  // ¶¨ÒåÊ±¼äÀàÐÍ 
  73          {
  74            uchar hour;
  75            uchar minute;
  76            uchar second;
  77          }time;
  78          
  79          typedef struct                  // ¶¨ÒåÈÕÆÚÀàÐÍ 
  80          {
  81            uchar year;
  82            uchar month;
  83            uchar day;
  84            uchar week;
  85          }date;
  86          
  87          typedef union               // ¶¨ÒåÎÂ¶ÈÀàÐÍ
  88          {
  89            int temp_data;
  90            uchar t_data[2];
  91          }trdata;
  92          
  93          trdata  bdata  temp;             // ÎÂ¶È¾¯±¨ÖµÔÝ´æ      
  94          date    idata  today={'8',1,1,1};        // ÈÕÆÚÔÝ´æ
  95          time    idata  now={0x12,0,0} , save_time={0x12,0,0}; 
  96                        // Ê±¼äÔÝ´æ(nowÊÇ¶Á³öÊ±¼äÔÝ´æ save_timeÉÏÒ»Ê±¼äÔÝ´æ)
  97          uchar   idata  time_tick=20,time_tick1=20,alarm_time[2],als_temp[2], 
  98                        // T0ÖÐ¶ÏÊý,     T1ÖÐ¶ÏÊý,     ÄÖÁåÊ±¼ä,   ¾¯±¨ÎÂ¶È
  99                         bl_delay=15,temp_delay=5,opera[2][12],resu[12], 
 100                                    // ±³¹âÊ±¼ä,  ÎÂ¶È¸üÐÂÊ±¼ä, ¼ÆËãÆ÷Êý¾Ý¼Ä´æ, ½á¹û¼Ä´æ
 101                                     i,j,save1,temp_min=0; 
 102                                     // ¼ÆËãÆ÷i/jÏÂ±ê£¬ÖÐ¼äÔÝ´æ,ÎÂ¶È¸üÐÂ£¨·Ö£©
 103          
 104          
 105          
 106          uchar  bdata   signs=0;          // ÏµÍ³±ê¼Ç¼Ä´æÆ÷
 107            sbit bl1=signs^7;              // bl1,bl0±³¹âÑ¡ÔñÎ»(00 ÑÓÊ±,01 ³£¿ª,10 ¹Ø±Õ) 
 108            sbit bl0=signs^6;                     
 109            sbit di1=signs^5;                      // di1,di0ÏÔÊ¾Ä£Ê½(00Ä£Ê½1,01Ä£Ê½2,10Ä£Ê½3)
 110            sbit di0=signs^4;                     
 111            sbit meu=signs^3;                      // ²Ëµ¥ÏÔÊ¾·½Ê½(0 Í¼Æ¬,1 ÎÄ×Ö)
 112            sbit keb=signs^2;                      // ¼üÅÌËø(0 ÎÞËø,1¼ÓËø)
 113            sbit alm=signs^1;                      // ÄÖÖÓÆô¶¯Î»(0 ¹Ø±Õ,1¿ªÆô)
 114            sbit als=signs^0;                      // ±¨¾¯Æô¶¯Î»(0 Æô¶¯,1¹Ø±Õ)
 115          
 116          
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 3   

 117          
 118          uint   bdata   run_signs=0;     // ÔËÐÐ±ê¼Ç¼Ä´æÆ÷
 119            sbit ds18b20=run_signs^0;             // ÎÂ¸ÐÆ÷´æÔÚ±ê¼Ç(0²»´æÔÚ£¬1´æÔÚ)
 120            sbit temp_pn=run_signs^1;             // ÎÂ¶ÈÕý¸ººÅ±ê¼Ç(0Õý£¬1¸º)
 121            sbit temprun=run_signs^2;             // ÎÂ¸ÐÆ÷ÔËÐÐ±ê¼Ç(0·ñ£¬1Æô¶¯)
 122            sbit nba_tim=run_signs^3;     // ÀºÇò¼ÆÊ±Æ÷±ê¼Ç(0¹Ø±Õ£¬1Æô¶¯)
 123            sbit adju_si=run_signs^4;             // Êý×Ö¸ü¸ÄÁ¬Ðø±ê¼Ç(1Á¬Ðø)
 124            sbit cal_del=run_signs^5;     // ¼ÆËãÆ÷ÏÔÊ¾µã±ê¼Ç£¨0Ã»ÓÐÏÔÊ¾£©
 125            sbit cal_run=run_signs^6;         // ¼ÆËãÍê±Ï±ê¼Ç£¨1ÓÐÐ§£©
 126            sbit oth_run=run_signs^7;     // ÆäËû±ê¼Ç
 127            sbit alm_run=run_signs^8;     // ÄÖÖÓÊ±¼äµ½´ï±ê¼Ç£¨1ÓÐÐ§£©
 128            sbit dis_sig=run_signs^9;     // ÏÔÊ¾Ê±¼ä±ê¼Ç£¨1ÓÐÐ§£©
 129            sbit lock_op=run_signs^10;    // ¹ØËøÊ±¼äµ½±ê¼Ç£¨1ÓÐÐ§£©
 130            sbit b20time=run_signs^11;    // ÎÂ¸ÐÆ÷ÖØÐÂ¶ÁÎÂ¶È±ê¼Ç(1ÓÐÐ§)
 131            sbit t0_isr =run_signs^12;    // TOÖÐ¶Ï±ê¼Ç£¨1ÓÐÐ§(1s)
 132            sbit thl_als=run_signs^13;    // ÎÂ¶È¾¯±¨±ê¼Ç
 133            sbit init_d2=run_signs^14;    // Ä£Ê½2³õÊ¼ÏÔÊ¾
 134            sbit buzstop=run_signs^15;    // ·äÃùÆ÷Í£Ö¹±ê¼Ç
 135          
 136          
 137          
 138          
 139          /*================================= ×ÖÌåÏÔÊ¾´úÂë ==================================*/ 
 140          
 141          uchar code weeks[7][2]={"Ò»","¶þ","Èý","ËÄ","Îå","Áù","ÈÕ"}; // ÐÇÆÚ                            //Í¼Æ¬ÖÐÎÄ
 142          uchar code menu_cn[6][8]={"µ÷    Õû","¹¤    ¾ß","Éè    ÖÃ","±£    ÃÜ","°æ    ±¾","ÍË    ³ö"};
 143          uchar code menu_cn_2[6][6]={"µ÷  Õû","¹¤  ¾ß","Éè  ÖÃ","±£  ÃÜ","°æ  ±¾","ÍË  ³ö"};// ²Ëµ¥ÎÄ×Ö
 144          uchar code selected[2][16]={{"½øÈë¡¾      ¡¿\x04 "},{"ÉèÖÃ¡¾    ¡¿\x10 \x04 "}}; // Ñ¡¿ò
 145          uchar code secrets_menu[4][6]={"¿ª  Ëø","¸ü  ¸Ä","³õÊ¼»¯","ÍË  ³ö"};           // ±£ÃÜ²Ëµ¥ÖÐÎÄ
 146          uchar code tool_menu[5][6]={"¼ÆËãÆ÷","ÎÂ¶È¼Æ","ÄÖ  Áå","ÀºÇòÆ÷","ÍË  ³ö"};         // ¹¤¾ß²Ëµ¥ÖÐÎÄ
 147          uchar code char_num[10]={"0123456789"};  // Êý×ÖÏÔÊ¾´úÂë                                                         // Ã¿ÔÂÌìÊý
 148          uchar code dayofmonth[12]={0x31,0x28,0x31,0x30,0x31,0x30,0x31,0x31,0x30,0x31,0x30,0x31}; 
 149          uchar code key_code[]={0xD7,0x7E,0x7D,0x7B,0xBE,0xBD,0xBB,0xDE,0xDD,0xDB,0xB7,0x77,0xEE,0xED,0xEB,0xE7};
 150          uchar code ksp[4]={0x7F,0xBF,0xDF,0xEF};         // °´¼üÉ¨Ãè´úÂë
 151          uchar code tool_cal[4][2]={"+ ","- ","* ","/ "}; // ÔËËã·ûºÅ
 152          uchar code alm_sign[2][2]={"¹Ø","¿ª"};                   // ÄÖÁå¿ª¹Ø
 153          uchar code set_bl_dm[2][3][4]={{"30Ãë","³£¿ª","¹Ø±Õ"},{"Ä£01","Ä£02","Ä£03"}};
 154          uchar code set_mka[3][2][4]={{"Í¼Æ¬","ÎÄ×Ö"},{"½âËø","¼ÓËø"},{"¿ªÆô","¹Ø±Õ"}};
 155          uchar code nba_oppo[8][2]={"ºì","°×","À¶","ÂÌ","×Ï","»Ò","»Æ","ºÚ"};
 156          uchar code set_menu[6][4]={"±³¹â","ÏÔÊ¾","²Ëµ¥","¼üÅÌ","¾¯±¨","ÍË³ö"};
 157          
 158          
 159          uchar code version[10][14]={   // °æ±¾ÐÅÏ¢
 160                                      {"ÇåÔ¶Ö°Òµ¼¼ÊõÑ§"},
 161                                                                  {"  ÐÅÏ¢¿Æ¼¼Ñ§Ôº"},
 162                                                          {"08½ì±ÏÒµÉè¼Æ  "},
 163                                                          {"  ¡ª05µç×Ó02°à"},
 164                                                  {"×÷Õß£ºÀî½õ»ª  "},
 165                                                          {"Ö¸µ¼£ºÀî×æÃ÷  "},
 166                                                          {"°æ±¾:LIJH-V1.0"},
 167                                                          {"    2008/06/19"},
 168                                                          {"Ð»Ð»ÄãµÄÊ¹ÓÃ£¡"},
 169                                                          {"         (ok)\x10"}};
 170          
 171          
 172          uchar code timer_tips[12][16]={ // ÀºÇòÆ÷Ê¹ÓÃËµÃ÷
 173                                      {"Ê¹ÓÃ·½·¨£º      "},
 174                                                                  {"  (+)(-)Óë(*)(/)"},
 175                                                                  {"·Ö±ðÊÇÁ½·½µÄ·ÖÊý"},
 176                                                                  {"¼ÓÓë¼õ,(7)¼ü»ØÍË"},
 177                                                                  {"Ò»Ãë,(8)¼ü24Ãë¸´"},
 178                                                                  {"Î»,(9)¼üÔÝÍ£Óë¿ª"},
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 4   

 179                                                                  {"Ê¼£»ÔÝÍ£×´Ì¬ÏÂ£º"},
 180                                                                  {"°´Á½´Î(OK)¼ü¿É·µ"},
 181                                                                  {"»ØÊ±ÖÓÄ£Ê½-2½çÃæ"},
 182                                                                  {"£¬(OK)¼ü·µ»Ø³ÌÐò"},
 183                                                                  {"½çÃæ,(./S)¼üÁ½´Î"},
 184                                                                  {"ÍË³ö³ÌÐò.      \x1f"}};
 185          
 186          
 187          
 188          /*================================= ²Ù×÷µ¼º½´úÂë ==================================*/ 
 189          
 190           
 191          typedef struct                  // ¶¨ÒåÖ÷²Ëµ¥²Ù×÷Ë÷Òý 
 192          {
 193            uchar shaft_num;
 194            uchar left_num;
 195            uchar right_num;
 196          }menu_index;
 197          
 198          typedef struct                  // ¶¨Òåµ¼º½¸ü¸ÄË÷Òý 
 199          {
 200            uchar lnum;
 201            uchar rnum;
 202          }index;
 203          
 204          menu_index code index_m[6]={{3,5,1},{4,0,2},{5,1,3},{0,2,4},{1,3,5},{2,4,0}}; // ²Ëµ¥µ¼º½
 205          index code index_t[6]={{4,1},{0,2},{1,3},{2,4},{3,0}};       // ¹¤¾ßµ¼º½
 206          index code index_p[5]={{3,1},{0,2},{1,3},{2,0}};             // ±£ÃÜµ¼º½
 207          index code index_s[6]={{5,1},{0,2},{1,3},{2,4},{3,5},{4,0}}; // ÉèÖÃµ¼º½
 208          index code index_a[7]={{0x81,0x91},{0x83,0x91},{0x85,0x91},{0x89,0x81},
 209                                          {0x8b,0x81},{0x8d,0x81},{0x8f,0x91}};       // µ÷ÕûÏÂµÄ×ø±ê
 210          index code index_temp_set[3]={{0x8b,0x81},{0x8b,0x91},{0x8f,0x91}}; // ÎÂ¶ÈÉè¶¨ÏÂµÄ×ø±ê
 211          index code index_alm[3]={{0x8c,0x81},{0x8e,0x81},{0x8f,0x91}};      // ÄÖÁå¸ü¸Ä×ø±ê     
 212          index code index_cal[3]={{0x86,0x90},{0x8e,0x80},{0x8e,0x90}};      // ¼ÆËãÆ÷²Ù×÷×ø±ê
 213          uchar code index_nba[4]={0x93,0x97,0x8b,0x8f};                                      // ÀºÇòÆ÷ÉèÖÃµ¼º½
 214          
 215          
 216          
 217          
 218          
 219          /*========================== ²Ëµ¥Í¼Æ¬£¨¿í¶Èx¸ß¶È=32*24£©=============================*/
 220          
 221          uchar code menu_pic[6][96]={ 
 222                  {// µ÷Õû 
 223                   0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x40,0x00,0x00,0x02,0x40,0x00,0x00,0x02,
 224                   0x40,0x00,0x00,0x82,0x47,0xFF,0xE1,0xC2,0x47,0xFF,0xF3,0xE2,0x47,0x38,0x68,0x02,
 225                   0x46,0xDF,0x68,0x82,0x46,0xDF,0x69,0xC2,0x46,0xDE,0xE8,0x82,0x46,0xDD,0xE8,0x02,
 226                   0x46,0xDD,0xE8,0x02,0x47,0x3D,0xE8,0x02,0x47,0xFF,0xE8,0x02,0x47,0xFF,0xE9,0xC2,
 227                   0x42,0x00,0x18,0x02,0x41,0xFF,0xF3,0xE2,0x40,0x00,0x01,0xC2,0x40,0x00,0x00,0x82,
 228                   0x40,0x00,0x00,0x02,0x40,0x00,0x00,0x02,0x7F,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00},
 229                  
 230                  {// ¹¤¾ß                                        
 231                   0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x40,0x00,0x00,0x02,0x40,0x00,0x03,0x82,
 232                   0x41,0xF0,0x07,0xC2,0x43,0xFF,0xCF,0xE2,0x47,0x3F,0xFE,0x02,0x47,0x3F,0xFE,0x02,
 233                   0x43,0xFF,0xCF,0xE2,0x41,0xF0,0x0F,0xC2,0x40,0x00,0x03,0x82,0x40,0x00,0x00,0x02,
 234                   0x40,0x00,0x03,0xC2,0x40,0x00,0x03,0xC2,0x41,0x80,0x01,0x82,0x43,0xFF,0xF3,0xC2,
 235                   0x47,0xFF,0xFF,0xE2,0x47,0xFF,0xFF,0xE2,0x43,0xFF,0xF3,0xC2,0x41,0x80,0x01,0x82,
 236                   0x40,0x00,0x01,0x82,0x40,0x00,0x00,0x02,0x7F,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00},
 237                  
 238                  {// ÉèÖÃ
 239                   0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x40,0x00,0x00,0x02,0x43,0x18,0x00,0x02,
 240                   0x44,0xA4,0x0E,0x02,0x44,0xA4,0x1F,0x02,0x43,0x24,0x3F,0x02,0x40,0x00,0x7F,0x02,
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 5   

 241                   0x40,0xF0,0xFC,0x02,0x43,0xF9,0xF0,0x02,0x43,0x03,0xE0,0x02,0x46,0x77,0x80,0x02,
 242                   0x46,0x7F,0x00,0x02,0x46,0x7E,0x00,0x02,0x46,0x7C,0x00,0x02,0x47,0x3D,0x00,0x02,
 243                   0x43,0x1D,0x81,0x22,0x43,0x81,0xB2,0x42,0x41,0xC3,0x4F,0xE2,0x40,0xFE,0x4A,0x42,
 244                   0x40,0x3C,0x32,0x42,0x40,0x00,0x00,0x02,0x7F,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00},
 245                  
 246                  {// ±£ÃÜ
 247                   0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x40,0x00,0x00,0x02,0x40,0xFC,0x03,0x02,
 248                   0x41,0xFE,0x1F,0x02,0x43,0x87,0x03,0x82,0x43,0x03,0x03,0x02,0x43,0x03,0x03,0x02,
 249                   0x43,0x03,0x0F,0x02,0x43,0x03,0x03,0x02,0x43,0x03,0x03,0x02,0x47,0xFF,0x83,0x02,
 250                   0x47,0xFF,0x83,0x02,0x47,0xCF,0x83,0x02,0x47,0x87,0x83,0x02,0x47,0xCF,0x83,0x02,
 251                   0x47,0xCF,0x87,0x82,0x47,0xCF,0x8F,0xC2,0x47,0xCF,0x9C,0xE2,0x47,0xFF,0x8F,0xC2,
 252                   0x43,0xFF,0x07,0x82,0x40,0x00,0x00,0x02,0x7F,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00},
 253                  
 254                  {// °æ±¾
 255                   0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x40,0x00,0x00,0x02,0x40,0x00,0x00,0x02,
 256                   0x40,0x0F,0x00,0x62,0x40,0x1D,0x80,0xF2,0x40,0x38,0x41,0xF2,0x40,0x70,0x23,0xE2,
 257                   0x40,0xE2,0x17,0xC2,0x41,0xE4,0x4F,0x82,0x41,0xF0,0x9F,0x02,0x41,0x59,0x16,0x02,
 258                   0x42,0x4C,0x1D,0x02,0x42,0x46,0x20,0x82,0x42,0x47,0x00,0x42,0x44,0x43,0x80,0xC2,
 259                   0x44,0x44,0xC1,0xC2,0x44,0xC8,0x63,0x82,0x45,0x50,0x37,0x02,0x46,0x60,0x1E,0x02,
 260                   0x40,0x40,0x0C,0x02,0x40,0x00,0x00,0x02,0x7F,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00},
 261                  
 262                  {// ÍË³ö
 263                   0x00,0x00,0x00,0x00,0x7F,0xFF,0xFF,0xFE,0x40,0x00,0x00,0x02,0x40,0x40,0xFF,0xE2,
 264                   0x40,0x60,0x80,0x62,0x43,0xF0,0x80,0xA2,0x43,0xF0,0x81,0x22,0x40,0x60,0x82,0x22,
 265                   0x40,0x40,0x84,0x22,0x40,0x00,0x88,0x22,0x40,0x00,0x88,0x22,0x47,0xFF,0xF8,0x22,
 266                   0x47,0xFF,0xF8,0x22,0x46,0x2A,0x2A,0x22,0x46,0xE3,0x78,0x22,0x46,0x77,0x78,0x22,
 267                   0x46,0xE3,0x78,0x62,0x46,0x2A,0x38,0x82,0x47,0xFF,0xF9,0x02,0x47,0xFF,0xFA,0x02,
 268                   0x40,0x00,0x0C,0x02,0x40,0x00,0x00,0x02,0x7F,0xFF,0xFF,0xFE,0x00,0x00,0x00,0x00,}};
 269          
 270          
 271          
 272          
 273          /*================ ÏÔÊ¾Ä£Ê½2Êý×Ö¼°ÎÂ¶È·ûºÅÍ¼Æ¬£¨¿í¶Èx¸ß¶È=16*32£©=====================*/
 274          
 275          uchar code mode_2num[11][64]={
 276                  {// Í¼Æ¬Êý×Ö0
 277                   0x00,0x00,0x3F,0xFC,0x5F,0xFA,0x6F,0xF6,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
 278                   0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x40,0x02,0x00,0x00,
 279                   0x40,0x02,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
 280                   0x70,0x0E,0x70,0x0E,0x70,0x0E,0x6F,0xF6,0x5F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},
 281                  
 282                  {// Í¼Æ¬Êý×Ö1
 283                   0x00,0x00,0x00,0x20,0x00,0x60,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,
 284               0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0x60,0x00,0x20,0x00,0x00,0x00,0x20,
 285                   0x00,0x60,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0xE0,
 286                   0x00,0xE0,0x00,0xE0,0x00,0xE0,0x00,0x60,0x00,0x20,0x00,0x00,0x00,0x00,0x00,0x00},
 287              
 288                  {// Í¼Æ¬Êý×Ö2
 289                   0x00,0x00,0x3F,0xFC,0x1F,0xFA,0x0F,0xF6,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 290                   0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x1F,0xFA,0x3F,0xFC,
 291                   0x5F,0xF8,0x60,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,
 292                   0x70,0x00,0x70,0x00,0x70,0x00,0x6F,0xF8,0x5F,0xFC,0x3F,0xFE,0x00,0x00,0x00,0x00},
 293                  
 294                  {// Í¼Æ¬Êý×Ö3
 295                   0x00,0x00,0x7F,0xFC,0x3F,0xFA,0x1F,0xF6,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 296               0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x1F,0xFA,0x3F,0xFC,
 297               0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 298               0x00,0x0E,0x00,0x0E,0x00,0x0E,0x1F,0xF6,0x3F,0xFA,0x7F,0xFC,0x00,0x00,0x00,0x00},
 299                  
 300                  {// Í¼Æ¬Êý×Ö4
 301                   0x00,0x00,0x40,0x02,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
 302                   0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x5F,0xFA,0x3F,0xFC,
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 6   

 303                   0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 304                   0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x00,0x02,0x00,0x00,0x00,0x00},
 305                  
 306                  {// Í¼Æ¬Êý×Ö5
 307                   0x00,0x00,0x3F,0xFC,0x5F,0xF8,0x6F,0xF0,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,
 308                   0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x60,0x00,0x5F,0xF8,0x3F,0xFC,
 309                   0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 310                   0x00,0x0E,0x00,0x0E,0x00,0x0E,0x0F,0xF6,0x1F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},
 311                  
 312                  {// Í¼Æ¬Êý×Ö6
 313                   0x00,0x00,0x3F,0xFC,0x5F,0xF8,0x6F,0xF0,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,
 314                   0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x70,0x00,0x60,0x00,0x5F,0xF8,0x3F,0xFC,
 315                   0x5F,0xFA,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
 316                   0x70,0x0E,0x70,0x0E,0x70,0x0E,0x6F,0xF6,0x5F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},
 317                  
 318                  {// Í¼Æ¬Êý×Ö7
 319                   0x00,0x00,0x7F,0xFC,0x3F,0xFA,0x1F,0xF6,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 320                   0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x00,0x02,0x00,0x00,
 321                   0x00,0x02,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 322                   0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x06,0x00,0x02,0x00,0x00,0x00,0x00},
 323                  
 324                  {// Í¼Æ¬Êý×Ö8
 325                   0x00,0x00,0x3F,0xFC,0x5F,0xFA,0x6F,0xF6,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
 326                   0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x5F,0xFA,0x3F,0xFC,
 327                   0x5F,0xFA,0x60,0x06,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
 328                   0x70,0x0E,0x70,0x0E,0x70,0x0E,0x6F,0xF6,0x5F,0xFA,0x3F,0xFC,0x00,0x00,0x00,0x00},
 329                  
 330                  {// Í¼Æ¬Êý×Ö9
 331                   0x00,0x00,0x3F,0xFC,0x5F,0xFA,0x6F,0xF6,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,
 332                   0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x70,0x0E,0x60,0x06,0x5F,0xFA,0x3F,0xFC,
 333                   0x1F,0xFA,0x00,0x06,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,0x00,0x0E,
 334                   0x00,0x0E,0x00,0x0E,0x00,0x0E,0x1F,0xF6,0x3F,0xFA,0x7F,0xFC,0x00,0x00,0x00,0x00},
 335                  
 336                  {// ÎÂ¶È·ûºÅ
 337               0x00,0x00,0x00,0x00,0x70,0xE0,0x53,0xF0,0x77,0xFA,0x0E,0x0E,0x0C,0x06,0x18,0x06,
 338               0x18,0x02,0x38,0x02,0x30,0x00,0x30,0x00,0x70,0x00,0x60,0x00,0x60,0x00,0x60,0x00,
 339               0x60,0x00,0x60,0x00,0x70,0x00,0x30,0x00,0x30,0x00,0x38,0x00,0x18,0x02,0x18,0x02,
 340               0x0C,0x06,0x0E,0x06,0x07,0x0E,0x03,0xFA,0x00,0xF0,0x00,0x60,0x00,0x00,0x00,0x00}};
 341          
 342          
 343          
 344          
 345          
 346          /*===================== ÏÔÊ¾Ä£Ê½3Êý×ÖÍ¼Æ¬£¨¿í¶Èx¸ß¶È=24*32£©=========================*/
 347          
 348          uchar code mode_3num[10][96]={
 349                  {// Í¼Æ¬Êý×Ö0
 350                   0x00,0x7E,0x00,0x01,0xE7,0x80,0x03,0xC3,0xC0,0x07,0x81,0xE0,0x0F,0x80,0xF0,0x0F,
 351                   0x00,0xF0,0x1F,0x00,0xF8,0x1E,0x00,0xF8,0x3E,0x00,0x78,0x3E,0x00,0x7C,0x3E,0x00,
 352                   0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,
 353                   0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,
 354                   0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x78,0x1E,0x00,0xF8,0x1F,0x00,0xF8,0x0F,0x00,
 355                   0xF0,0x0F,0x81,0xF0,0x07,0x81,0xE0,0x03,0xC3,0xC0,0x01,0xE7,0x80,0x00,0x7E,0x00},
 356          
 357                  {// Í¼Æ¬Êý×Ö1
 358                   0x00,0x0C,0x00,0x00,0x1C,0x00,0x00,0x7C,0x00,0x07,0xFC,0x00,0x00,0x3C,0x00,0x00,
 359                   0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,
 360                   0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,
 361                   0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,
 362                   0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,
 363                   0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3E,0x00,0x00,0x7F,0x00,0x07,0xFF,0xF0},
 364                                     
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 7   

 365                  {// Í¼Æ¬Êý×Ö2
 366                   0x00,0xFF,0x00,0x03,0xC7,0xC0,0x07,0x01,0xE0,0x0E,0x00,0xF0,0x1E,0x00,0xF8,0x1E,
 367                   0x00,0xF8,0x3E,0x00,0x78,0x3E,0x00,0x78,0x3F,0x00,0x78,0x3F,0x00,0x78,0x1F,0x00,
 368               0xF8,0x00,0x00,0xF8,0x00,0x00,0xF0,0x00,0x01,0xF0,0x00,0x03,0xE0,0x00,0x03,0xC0,
 369                   0x00,0x07,0x80,0x00,0x0F,0x00,0x00,0x1E,0x00,0x00,0x3C,0x00,0x00,0x78,0x00,0x00,
 370                   0xF0,0x00,0x01,0xE0,0x00,0x03,0xC0,0x00,0x07,0x80,0x1C,0x07,0x00,0x1C,0x0E,0x00,
 371                   0x38,0x1C,0x00,0x38,0x3C,0x00,0x78,0x3F,0xFF,0xF8,0x3F,0xFF,0xF8,0x3F,0xFF,0xF8},
 372          
 373                  {// Í¼Æ¬Êý×Ö3
 374                   0x00,0xFE,0x00,0x07,0x87,0x80,0x0F,0x03,0xC0,0x1E,0x01,0xE0,0x1E,0x01,0xF0,0x1E,
 375                   0x01,0xF0,0x1F,0x00,0xF0,0x1F,0x00,0xF0,0x1E,0x00,0xF0,0x00,0x00,0xF0,0x00,0x01,
 376                   0xF0,0x00,0x01,0xF0,0x00,0x03,0xE0,0x00,0x03,0xC0,0x00,0x0F,0x00,0x00,0xFE,0x00,
 377                   0x00,0x07,0x80,0x00,0x01,0xE0,0x00,0x00,0xF0,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,
 378                   0x00,0x78,0x00,0x00,0x7C,0x1E,0x00,0x7C,0x3F,0x00,0x7C,0x3F,0x00,0x7C,0x3F,0x00,
 379                   0x78,0x3E,0x00,0xF8,0x1E,0x00,0xF0,0x0F,0x01,0xE0,0x07,0x87,0xC0,0x01,0xFF,0x00},
 380          
 381                  {// Í¼Æ¬Êý×Ö4
 382                   0x00,0x03,0xC0,0x00,0x03,0xC0,0x00,0x07,0xC0,0x00,0x0F,0xC0,0x00,0x0F,0xC0,0x00,
 383                   0x1F,0xC0,0x00,0x3F,0xC0,0x00,0x3F,0xC0,0x00,0x77,0xC0,0x00,0x77,0xC0,0x00,0xE7,
 384                   0xC0,0x01,0xC7,0xC0,0x01,0xC7,0xC0,0x03,0x87,0xC0,0x07,0x07,0xC0,0x07,0x07,0xC0,
 385                   0x0E,0x07,0xC0,0x1E,0x07,0xC0,0x1C,0x07,0xC0,0x38,0x07,0xC0,0x38,0x07,0xC0,0x7F,
 386                   0xFF,0xFE,0x7F,0xFF,0xFE,0x00,0x07,0xC0,0x00,0x07,0xC0,0x00,0x07,0xC0,0x00,0x07,
 387                   0xC0,0x00,0x07,0xC0,0x00,0x07,0xC0,0x00,0x07,0xC0,0x00,0x07,0xE0,0x00,0x7F,0xFE},
 388          
 389                  {// Í¼Æ¬Êý×Ö5
 390                   0x0F,0xFF,0xF8,0x0F,0xFF,0xF8,0x0F,0xFF,0xF8,0x0E,0x00,0x00,0x0E,0x00,0x00,0x0E,
 391                   0x00,0x00,0x0E,0x00,0x00,0x0E,0x00,0x00,0x0E,0x00,0x00,0x0E,0x00,0x00,0x0E,0x00,
 392                   0x00,0x0E,0x7F,0x00,0x0D,0xFF,0xC0,0x0F,0xC3,0xE0,0x1F,0x01,0xF0,0x1E,0x00,0xF8,
 393                   0x1E,0x00,0xF8,0x00,0x00,0x78,0x00,0x00,0x7C,0x00,0x00,0x7C,0x00,0x00,0x7C,0x00,
 394                   0x00,0x7C,0x1E,0x00,0x7C,0x3F,0x00,0x7C,0x3F,0x00,0x78,0x3F,0x00,0x78,0x3E,0x00,
 395                   0xF8,0x1E,0x00,0xF0,0x1E,0x01,0xF0,0x0E,0x01,0xE0,0x07,0x87,0xC0,0x00,0xFF,0x00},
 396          
 397                  {// Í¼Æ¬Êý×Ö6
 398                   0x00,0x3F,0xC0,0x00,0xF1,0xE0,0x03,0xC1,0xF0,0x07,0x81,0xF8,0x07,0x01,0xF8,0x0F,
 399                   0x00,0xF0,0x1F,0x00,0x00,0x1E,0x00,0x00,0x1E,0x00,0x00,0x3E,0x00,0x00,0x3E,0x00,
 400                   0x00,0x3E,0x00,0x00,0x3E,0x3F,0x80,0x3E,0xFF,0xE0,0x3F,0xE3,0xF0,0x3F,0x80,0xF8,
 401                   0x3F,0x00,0xF8,0x3F,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x7C,0x3E,0x00,0x3C,0x3E,
 402                   0x00,0x3C,0x3E,0x00,0x3C,0x3E,0x00,0x3C,0x3E,0x00,0x7C,0x1E,0x00,0x7C,0x1F,0x00,
 403                   0x78,0x0F,0x00,0x78,0x0F,0x80,0xF0,0x07,0xC0,0xE0,0x03,0xE3,0xC0,0x00,0xFF,0x00},
 404          
 405                  {// Í¼Æ¬Êý×Ö7
 406                   0x1F,0xFF,0xFC,0x1F,0xFF,0xFC,0x1F,0xFF,0xF8,0x1F,0x00,0x38,0x1C,0x00,0x70,0x1C,
 407                   0x00,0xE0,0x38,0x00,0xE0,0x38,0x01,0xC0,0x00,0x01,0xC0,0x00,0x03,0x80,0x00,0x03,
 408                   0x80,0x00,0x07,0x80,0x00,0x07,0x00,0x00,0x0F,0x00,0x00,0x0E,0x00,0x00,0x1E,0x00,
 409                   0x00,0x1E,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x3C,0x00,0x00,0x7C,0x00,0x00,
 410                   0x78,0x00,0x00,0x78,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,
 411                   0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0x78,0x00},
 412          
 413                  {// Í¼Æ¬Êý×Ö8
 414                   0x00,0xFF,0x00,0x07,0xC3,0xC0,0x0F,0x00,0xE0,0x1E,0x00,0xF0,0x1E,0x00,0x78,0x3C,
 415                   0x00,0x78,0x3C,0x00,0x78,0x3C,0x00,0x7C,0x3E,0x00,0x78,0x3E,0x00,0x78,0x1F,0x00,
 416                   0x78,0x1F,0x80,0xF0,0x0F,0xE1,0xE0,0x07,0xFB,0xC0,0x01,0xFF,0x80,0x01,0xFF,0x80,
 417                   0x07,0xBF,0xC0,0x0F,0x0F,0xE0,0x1E,0x03,0xF0,0x3E,0x01,0xF8,0x3C,0x00,0xF8,0x3C,
 418                   0x00,0x7C,0x7C,0x00,0x7C,0x78,0x00,0x3C,0x78,0x00,0x3C,0x7C,0x00,0x3C,0x3C,0x00,
 419                   0x78,0x3C,0x00,0x78,0x1E,0x00,0x70,0x0F,0x00,0xE0,0x07,0xC3,0xC0,0x01,0xFF,0x00},
 420          
 421                  {// Í¼Æ¬Êý×Ö9
 422                   0x01,0xFE,0x00,0x07,0xC7,0x80,0x0F,0x01,0xE0,0x1E,0x01,0xE0,0x1E,0x00,0xF0,0x3E,
 423                   0x00,0xF8,0x3C,0x00,0x78,0x3C,0x00,0x78,0x7C,0x00,0x7C,0x7C,0x00,0x7C,0x7C,0x00,
 424                   0x7C,0x7C,0x00,0x7C,0x7C,0x00,0x7C,0x3C,0x00,0xFC,0x3E,0x00,0xFC,0x3E,0x01,0xFC,
 425               0x1F,0x03,0xFC,0x1F,0x8F,0xFC,0x0F,0xFF,0x7C,0x03,0xFC,0x7C,0x00,0x00,0x7C,0x00,
 426               0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF8,0x00,0x00,0xF0,0x00,0x01,0xF0,0x0F,0x01,
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 8   

 427                   0xE0,0x1F,0x01,0xE0,0x1F,0x03,0xC0,0x1F,0x07,0x80,0x0F,0x9F,0x00,0x03,0xFC,0x00}};
 428          
 429          
 430          
 431          
 432          /*========================== ±ê¼Ç¼°µãÍ¼Æ¬£¨¿í¶Èx¸ß¶È=16*16£©===========================*/
 433          
 434          
 435          uchar code running[7][32]={
 436               {// ¾¯±¨±ê¼Ç16*16
 437                    0x00,0x00,0x00,0x39,0x00,0x7B,0x00,0xFE,0x01,0xDC,0x0F,0x98,0x0F,0x18,0x0C,0x1F,
 438                0x0C,0x1F,0x0F,0x18,0x0F,0x98,0x01,0xDC,0x00,0xFE,0x00,0x7B,0x00,0x39,0x00,0x00,},
 439                   {// ÄÖÁå¿ªÆô±ê¼Ç16*16
 440                    0x00,0x00,0x00,0x40,0x00,0xE0,0x01,0xB0,0x01,0xB0,0x03,0x18,0x03,0x18,0x06,0x0C,
 441                0x0C,0x06,0x0C,0xE6,0x1B,0x1B,0x0C,0x06,0x06,0x0C,0x03,0xF8,0x00,0xE0,0x00,0x00},
 442                   {// ¼üÅÌËø±ê¼Ç16*16
 443                0x00,0x00,0x01,0xF8,0x03,0xFC,0x03,0x0C,0x03,0x0C,0x03,0x0C,0x03,0xFC,0x06,0x96,
 444                0x0E,0xA7,0x0E,0xC7,0x0E,0xA7,0x0E,0x97,0x07,0xFE,0x03,0xFC,0x01,0xF8,0x00,0x00,},
 445                   {// ÎÂ¶È¼Æ±ê¼Ç16*16
 446                    0x00,0x00,0x1F,0xF8,0x1F,0xF8,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,0x01,0x80,
 447                0x01,0x90,0x01,0x98,0x01,0x9C,0x01,0x9E,0x01,0x9C,0x00,0x18,0x00,0x10,0x00,0x00},
 448                   {// Ä£Ê½3µã16*16
 449                    0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xC0,0x03,0xC0,0x03,0xC0,0x03,0xC0,0x03,0xC0,
 450                0x03,0xC0,0x03,0xC0,0x03,0xC0,0x03,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},
 451                   {// Ä£Ê½2µã16*16
 452                    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x03,0xC0,0x03,0xC0,0x03,0xC0,0x03,0xC0,
 453                0x03,0xC0,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00},   
 454                   {// ÀºÇòÆ÷ÔËÐÐ±ê¼Ç16*16
 455                    0x00,0x00,0x00,0x00,0x00,0x00,0x1F,0xF8,0x1F,0xF8,0x01,0x80,0x01,0x80,0x01,0x90,
 456                0x01,0x98,0x01,0x9C,0x01,0x9E,0x01,0x9C,0x01,0x98,0x01,0x90,0x00,0x00,0x00,0x00}};
 457          
 458          
 459          /*========================== ²Ëµ¥°´Å¥Í¼Æ¬£¨¿í¶Èx¸ß¶È=16*8£©============================*/
 460          
 461          uchar code menu_key[]=
 462                   {//²Ëµ¥°´Å¥
 463                    0x7F,0xFE,0x81,0x81,0x83,0xC1,0x87,0xE1,0x8F,0xF1,0x9F,0xF9,0x80,0x01,0x7F,0xFE};
 464          
 465          
 466          
 467          
 468          
 469          /*=====================================================================================
 470           º¯ÊýÃû³Æ£º¶¨Ê±Æ÷ÖÐ¶Ï´¦ÀíÓë³õÊ¼»¯£¬ÑÓÊ±
 471           ¹¦ÄÜÃèÊö£ºÊ±ÖÓ¸üÐÂ¡¢ÀºÇòÆ÷¼ÆÊ±
 472           È«¾Ö±äÁ¿£ºtime_tick¡¢time_tick1¡¢resu[2]¡¢resu[3]¡¢resu[4]¡¢temp_delay¡¢temp_min
 473           ²ÎÊýËµÃ÷£ºÎÞ
 474           ·µ»ØËµÃ÷£ºt0_isr(ÖÐ¶Ï±ê¼Ç)¡¢b20time(ÎÂ¶È¸üÐÂ±ê¼Ç)
 475           Éè ¼Æ ÈË£ºLIJH
 476           °æ    ±¾£º1.0
 477           Ëµ    Ã÷£º
 478           ======================================================================================*/
 479          
 480          
 481          /*ÑÓÊ±£¨Ò»´Î10¸ö»úÆ÷ÖÜÆÚ²»µÈ£© ²ÎÊý¸ñÊ½£ºÑÓÊ±Êý*/
 482          void delay(unsigned int det)
 483          {
 484   1        while(det--);
 485   1      }
 486          
 487          
 488          
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 9   

 489          /*1sÑÓÊ±*/
 490          void delay_pw()
 491          {
 492   1        delay(60000);
 493   1        delay(60000);
 494   1      }
 495          
 496          
 497          /*6¸öÖÜÆÚ  6us */
 498          void  delay_b20(uchar n)
 499          {  
 500   1        while(n--);
 501   1      }
 502          
 503          
 504          
 505          /*Ö÷Ê±ÖÓÖÐ¶Ï´¦Àí*/
 506          void time0_isr(void) interrupt  TF0_VECTOR  using 1
 507          {
 508   1        TR0=0;
 509   1        TL0=(time_count&0x00FF);
 510   1        TH0=(time_count>>8);
 511   1        TR0=1;
 512   1        if(--time_tick)  return;
 513   1        time_tick=20;
 514   1        t0_isr=1;
 515   1        if(nba_tim&!oth_run)     // µ±ÔÚÀºÇòÆ÷½çÃæÊ± nba_tim==1¡¢oth_run==0 
 516   1        {
 517   2          if(resu[3]==0)
 518   2              {
 519   3                resu[3]=59;
 520   3                if(resu[2]>0) resu[2]--;
 521   3              }
 522   2              else resu[3]--;
 523   2              if(resu[2]==0&resu[3]==0)  // ±ÈÈüÊ±¼äµ½ºóÍ£Ö¹
 524   2              {
 525   3                TR0=0;TR1=0;EA=0;
 526   3              }
 527   2              return;
 528   2        }
 529   1        if((++temp_min)==60)    // ÊµÏÖÎÂ¶ÈµÄ¸üÐÂ
 530   1        {
 531   2          temp_min=0;
 532   2          temp_delay--;
 533   2              if(temp_delay==0)
 534   2          {
 535   3                b20time=1;temp_delay=5;
 536   3              }
 537   2        }     
 538   1      }
 539          
 540          
 541          /*24Ê±ÖÓÖÐ¶Ï´¦Àí*/
 542          void time1_isr(void) interrupt  TF1_VECTOR  using 2
 543          {
 544   1        TR1=0;
 545   1        TL1=(time_count&0x00FF);
 546   1        TH1=(time_count>>8);
 547   1        TR1=1;
 548   1        if(--time_tick1) return;
 549   1        time_tick1=20;
 550   1        if(resu[4]>0)resu[4]--;         //  ÀºÇòÆ÷24ÃëÖÐ¶Ï
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 10  

 551   1        t0_isr=1;
 552   1        if(resu[4]==0)
 553   1        { TR0=0;TR1=0;EA=0;}
 554   1      }
 555          
 556          
 557          /*¶¨Ê±Æ÷³õÊ¼»¯*/
 558          void time_init()                        
 559          {
 560   1        EA=0;
 561   1        TR0=0;
 562   1        TR1=0;
 563   1        TMOD=0x11;
 564   1        TL0=(time_count&0x00FF);
 565   1        TH0=(time_count>>8);
 566   1        TL1=(time_count&0x00FF);
 567   1        TH1=(time_count>>8);
 568   1        IE=0;
 569   1        ET0=1;
 570   1        ET1=1;
 571   1      }
 572          
 573          
 574          
 575          /*=====================================================================================
 576           º¯ÊýÃû³Æ£ºLCDÇý¶¯
 577           ¹¦ÄÜÃèÊö£º»ù±¾Çý¶¯£¨Ð´1¸ö×Ö½Ú¡¢ÇåÆÁ¡¢³õÊ¼»¯£©
 578           È«¾Ö±äÁ¿£ºÎÞ
 579           ²ÎÊýËµÃ÷£ºdat_comm£¨0£ºÃüÁî 1£ºÊý¾Ý£©,content£¨ÊýÖµ£©
 580           ·µ»ØËµÃ÷£ºÎÞ·µ»ØÖµ
 581           Éè ¼Æ ÈË£ºLIJH
 582           °æ    ±¾£º1.0
 583           Ëµ    Ã÷£º
 584           ======================================================================================*/
 585          
 586          
 587          /*¼ì²éÃ¦ÂµÎ»*/
 588          void chk_busy (void)
 589          {
 590   1        lcd_data = 0xff;
 591   1        lcd_rs = 0;    // ÃüÁî
 592   1        lcd_rw = 1;    // ¶Á
 593   1        lcd_e = 1;
 594   1        while(busy==1);
 595   1        lcd_e = 0;
 596   1      }
 597          
 598          
 599          /*Ð´LCD ²ÎÊý¸ñÊ½£º0:ÃüÁî,1:ÊýÖµ £¬Êý¾Ý*/
 600          void wr_lcd (uchar dat_comm,uchar content)
 601          {
 602   1        chk_busy ();
 603   1        lcd_rs=dat_comm;
 604   1        lcd_rw = 0;         // Ð´
 605   1        lcd_data=content;   // Êä³öÊý¾Ý»òÃüÁî
 606   1        lcd_e=1;             
 607   1        lcd_e=0;
 608   1      }
 609          
 610          
 611          /*Çå»æÍ¼*/
 612          void clrgdram(void)
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 11  

 613          {
 614   1        uchar i,j;
 615   1        for(j=0;j<32;j++)
 616   1        {
 617   2          wr_lcd(comm,0x34);
 618   2          wr_lcd(comm,0x80+j);
 619   2          wr_lcd(comm,0x80);
 620   2          wr_lcd(comm,0x30);
 621   2          for(i=0;i<32;i++)
 622   2            wr_lcd(dat,0x00);  // Ð´Èë0x00
 623   2         }
 624   1        wr_lcd(comm,0x36);
 625   1      }
 626          
 627          
 628          /*Çå³ýÏÔÊ¾*/
 629          void clear_dis(void)
 630          {
 631   1        wr_lcd(comm,0x30);
 632   1        wr_lcd(comm,0x01);  // ÇåÆÁ£¬µØÖ·Ö¸ÕëÖ¸Ïò00H
 633   1        clrgdram();             // Çë»æÍ¼RAM
 634   1      }
 635          
 636          
 637          
 638          /*¿ª»úLCD³õÊ¼»¯*/
 639          void init_lcd (void)
 640          {
 641   1        lcd_rst=1;
 642   1        wr_lcd(comm,0x30);  // 30---»ù±¾Ö¸Áî¶¯×÷  
 643   1        wr_lcd(comm,0x06);  // ¹â±êµÄÒÆ¶¯·½Ïò
 644   1        wr_lcd(comm,0x0c);  // ¿ªÏÔÊ¾£¬¹ØÓÎ±ê
 645   1        clear_dis(); 
 646   1      }
 647          
 648          
 649          
 650          
 651          
 652          /*=====================================================================================
 653           º¯ÊýÃû³Æ£ºDS1302Çý¶¯
 654           ¹¦ÄÜÃèÊö£º»ù±¾Çý¶¯£¨¶ÁÐ´Êý¾Ý¡¢¶ÁÐ´ÈÕÆÚ£¬Ê±¼ä¡¢³õÊ¼»¯£©
 655           È«¾Ö±äÁ¿£ºÎÞ
 656           ²ÎÊýËµÃ÷£ºw_adder£¨Ð´µØÖ·£©,r_adder£¨¶ÁµØÖ·£©£¬w_data£¨Ð´ÈëÊý¾Ý£©
 657           ·µ»ØËµÃ÷£º·µ»Ø¶ÁÈ¡µÄÊý¾Ý
 658           Éè ¼Æ ÈË£ºLIJH
 659           °æ    ±¾£º1.0
 660           Ëµ    Ã÷£ºÉÏÉýÑØÐ´ÈëÊýÖµ£¬ÏÂ½µÑØ¶Á³öÊýÖµ£¬Ã»ÓÃÉèÁ¢ºó±³µç³Ø³äµç
 661           ======================================================================================*/
 662          
 663          
 664          /*Ïò1302Ð´Êý¾Ý ²ÎÊý¸ñÊ½£ºµØÖ·£¬Êý¾Ý*/
 665          void w1302(uchar w_adder,uchar w_data)
 666          {
 667   1        uchar d;
 668   1        ret_ds1302();
 669   1        for(d=0;d<16;d++)
 670   1        {
 671   2          if(d==8) w_adder=w_data;
 672   2              d02_data=(bit)(w_adder&0x01);
 673   2          d02_sclk=0;          // ÉÏÉýÑØ
 674   2          w_adder>>=1;
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 12  

 675   2          d02_sclk=1;
 676   2        }
 677   1        end_ds1302();    
 678   1      }
 679          
 680          
 681          
 682          /*½ÓÊÕ1302Ò»¸ö×Ö½ÚµÄÊý¾Ý ²ÎÊý¸ñÊ½£º¶ÁµØÖ·*/
 683          uchar r1302(uchar r_adder)
 684          {
 685   1        uchar d=0;
 686   1        ret_ds1302();
 687   1        for(d=0;d<8;d++)       // Ð´µØÖ·
 688   1        {
 689   2          d02_data=(bit)(r_adder&0x01);
 690   2          d02_sclk=0;
 691   2          r_adder>>=1;
 692   2          d02_sclk=1;
 693   2        }
 694   1        r_adder=0;
 695   1        for(d=0;d<8;d++)       // ¶ÁÊý¾Ý 
 696   1        {
 697   2              d02_data=1;
 698   2              d02_sclk=1;              // ÏÂ½µÑØ
 699   2              r_adder>>=1;
 700   2              d02_sclk=0;
 701   2              if(d02_data) r_adder|=0x80;
 702   2        }
 703   1        end_ds1302();
 704   1        return(r_adder);
 705   1      }
 706          
 707          
 708          
 709          /*Ð´ÈëÊ±¼äÓëÈÕÆÚ*/
 710          void wds1302_time_date(void)
 711          {
 712   1        w1302(d02_wrc,0x00);                           // Ð´ÔÊÐí
 713   1        w1302(0x90,0xa5);                  // µ¥¶þ¼«¹Ü2Kµç×è³äµç
 714   1        w1302(d02_year,today.year);            // Äê
 715   1        w1302(d02_weeks,today.week);           // ÐÇÆÚ
 716   1        w1302(d02_month,today.month);          // ÔÂ
 717   1        w1302(d02_day,today.day);              // ÈÕ
 718   1        w1302(d02_hour,0x7f&now.hour);         // Ê±
 719   1        w1302(d02_minute,now.minute);          // ·Ö
 720   1        w1302(d02_second,0x7f&now.second); // Ãë
 721   1        w1302(d02_wrc,0x80);                           // Ð´½ûÖ¹
 722   1      }
 723          
 724          
 725          
 726          
 727          /*³õÊ¼»¯Ð´DS1302 RAM*/
 728          void init_wds1302_ram(void)
 729          {
 730   1        w1302(d02_wrc,0x00); 
 731   1        w1302(0x90,0xa5);         // µ¥¶þ¼«¹Ü2Kµç×è³äµç
 732   1        w1302(d02_signs,0x00);        // ×´Ì¬¼Ä´æ
 733   1        w1302(d02_passw,0x74);        // ÃÜÂë´¢´æÊ×Î»
 734   1        w1302(d02_passw+2,0x14);  // ³õÊ¼ÖµÎª:741456
 735   1        w1302(d02_passw+4,0x56);  // ÃÜÂë×îºóÒ»Î»
 736   1        w1302(d02_alm,0x12);          // ÄÖÁåÊ±(12Ð¡Ê±)
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 13  

 737   1        w1302(d02_alm+2,0x00);        // ÄÖÁå·Ö(0·Ö)
 738   1        w1302(d02_temp,0xff);         // ÎÂ¶ÈÉÏÏÞ(255Îª¹Ø±Õ)   
 739   1        w1302(d02_temp+2,0xff);   // ÎÂ¶ÈÏÂÏÞ(¹Ø±Õ)
 740   1        w1302(d02_initsi,0xb4);   // ÊÇ·ñÒª³õÊ¼»¯±ê¼Ç(0xb4ÎªÒÑ¾­³õÊ¼»¯)
 741   1        w1302(d02_wrc,0x80); 
 742   1      }
 743          
 744          /*Ð´DS1302Ò»×Ö½ÚµÄRAM*/
 745          void wds1302_data(uchar adder,uchar _data)
 746          {
 747   1        w1302(d02_wrc,0x00); 
 748   1        w1302(adder,_data);
 749   1        w1302(d02_wrc,0x80);
 750   1      } 
 751          
 752          
 753          /*¶ÁÈ¡ÈÕÆÚ*/
 754          void rds1302_date(void)
 755          {
 756   1        
 757   1        today.year=r1302(d02_year+1);   
 758   1        today.week=r1302(d02_weeks+1);
 759   1        today.month=r1302(d02_month+1);
 760   1        today.day=r1302(d02_day+1);  
 761   1      }
 762          
 763          
 764          /*¶ÁÈ¡Ê±¼ä*/
 765          void rds1302_time(void)
 766          {
 767   1        now.hour=(r1302(d02_hour+1));
 768   1        now.minute=r1302(d02_minute+1);
 769   1        now.second=r1302(d02_second+1);
 770   1        if(now.hour==alarm_time[0]&&now.minute==alarm_time[1]) alm_run=1;
 771   1        else                                                                          // ÄÖÁåÊ±¼ä±È½Ï
 772   1        {
 773   2          alm_run=0;buzstop=0;buzzer=close;
 774   2        } 
 775   1      }                                       
 776          
 777          /*¿ª»ú¶ÁÊý¾Ý*/
 778          void rds1302_data(void)
 779          {
 780   1        signs=r1302(d02_signs+1);
 781   1        alarm_time[0]=r1302(d02_alm+1);
 782   1        alarm_time[1]=r1302(d02_alm+3);
 783   1        als_temp[0]=r1302(d02_temp+1);
 784   1        als_temp[1]=r1302(d02_temp+3);                   
 785   1      }
 786           
 787          
 788          /*DS1302³õÊ¼»¯*/
 789          void init_ds1302(void)
 790          {
 791   1        wds1302_time_date();
 792   1        init_wds1302_ram();
 793   1      }
 794          
 795          
 796          /*=====================================================================================
 797           º¯ÊýÃû³Æ£ºDS18b20Çý¶¯
 798           ¹¦ÄÜÃèÊö£º»ù±¾Çý¶¯£¨¶ÁÐ´Êý¾Ý¡¢Êý¾Ý×ª»»¡¢³õÊ¼»¯£©
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 14  

 799           È«¾Ö±äÁ¿£ºÎÞ
 800           ²ÎÊýËµÃ÷£ºÎÞ
 801           ·µ»ØËµÃ÷£º·µ»Ø¶ÁÈ¡µÄÊý¾Ý
 802           Éè ¼Æ ÈË£ºLIJH
 803           °æ    ±¾£º1.0
 804           Ëµ    Ã÷£ºµ÷ÊÔÖÐ¡£¡£¡£
 805           ======================================================================================*/
 806          
 807          
 808          
 809          /*18B20³õÊ¼»¯*/
 810          void init_ds18b20()
 811          {
 812   1        b20_io=1;
 813   1        b20_io=0;
 814   1        delay_b20(120);               // ÑÓÊ±¡Ý480us
 815   1        b20_io=1;
 816   1        delay_b20(12);            // À­¸ßÎª¸ßµçÆ½ºóÔÚ15¡ª60us³öÏÖµÍµçÆ½£¬²¢Î¬³Ö60¡ª240us
 817   1        ds18b20=~b20_io;
 818   1        delay_b20(40);        
 819   1      }
 820          
 821          
 822          /*Ïò18B20·¢ËÍÒ»¸ö×Ö½Ú*/
 823          void send18b20_byte(uchar data_send)
 824          {
 825   1        uchar d=0;
 826   1        for (d=0;d<8;d++)
 827   1        {
 828   2              b20_io=0;                                       // À­µÍµçÆ½ºóÏò×ÜÏßÐ´ÈëÒ»¸öÎ»£¬15usºó18B20½ÓÊÕ  
 829   2          b20_io=data_send&0x01;          
 830   2          delay_b20(10);                              // ÑÓÊ±60usºóÍê³ÉÒ»´Î
 831   2          b20_io=1;
 832   2          data_send>>=1;                          // ÏÂÎ»¿ªÊ¼
 833   2        }
 834   1      }
 835          
 836          
 837          /*´Ó18B20¶Á³öÎÂ¶ÈÖµ 12Î»·Ö±æÂÊ*/  
 838          void receive18b20(void)
 839          {
 840   1        uchar n=1,d;
 841   1        for (d=0;d<16;d++)
 842   1        {
 843   2              if(d==8) n=0;
 844   2              b20_io=0;                                         // À­µÍ×ÜÏß
 845   2              temp.t_data[n]>>=1;            
 846   2              b20_io=1;                     // À­¸ß×ÜÏß
 847   2              if(b20_io)                                        // ¶ÁÈë×ÜÏßÊýÖµ
 848   2            temp.t_data[n]|=0x80;
 849   2          delay_b20(10);                                // µÈ´ý60us
 850   2        }
 851   1      }
 852          
 853          
 854          /*Êý¾Ý×ª»¯*/
 855          void conversion_t(void)
 856          {
 857   1        uchar save=0,save1=0;
 858   1        if(temp.temp_data<0)           // ÅÐ¶ÏÊýÖµ·ûºÅ
 859   1          {temp_pn=1;temp.temp_data=~temp.temp_data+1;}
 860   1        else temp_pn=0;
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 15  

 861   1        if(temp.t_data[1]&0x01==1) save+=6;       // Ð¡ÊýµãºóµÄÖµ×ª±ä
 862   1        if((temp.t_data[1]>>1)&0x01==1) save+=12;
 863   1        if((temp.t_data[1]>>2)&0x01==1) save+=25;
 864   1        if((temp.t_data[1]>>3)&0x01==1) save+=50;
 865   1        temp.temp_data>>=4;
 866   1        save1=temp.temp_data&0x00ff;                          // ÕûÊý²¿·ÖÊýÖµ
 867   1        temp.t_data[0]=save1;
 868   1        temp.t_data[1]=save;
 869   1        thl_als=1;
 870   1        if(save1>=(als_temp[0]&0x7f))      // ÎÂ¶È±È½Ï
 871   1        {
 872   2              if(!temp_pn||(temp_pn&(als_temp[0]&0x80)!=0)){ als_th=open;als_tl=close;}
 873   2        }
 874   1        else if(save1<(als_temp[1]&0x7f)&&als_temp[1]!=255)
 875   1        {
 876   2          if(!temp_pn||(temp_pn&(als_temp[1]&0x80)!=0)) {als_tl=open;als_th=close;}
 877   2        }
 878   1        else {als_th=als_tl=close;thl_als=0;buzstop=0;buzzer=close;} 
 879   1      }
 880          
 881          
 882          
 883          /*18b20¹¦ÄÜ*/
 884          void ds18b20_func(void)
 885          {
 886   1        EA=0;
 887   1        TR0=0;
 888   1        temp.temp_data=0;
 889   1        init_ds18b20(); 
 890   1        send18b20_byte(0xcc); // Ìø¹ýROM
 891   1        send18b20_byte(0x44); // ÎÂ¶È×ª»»
 892   1        delay_pw();
 893   1        init_ds18b20();
 894   1        send18b20_byte(0xcc); 
 895   1        send18b20_byte(0xbe); // ¶ÁRAM
 896   1        receive18b20();               // ¶ÁÈ¡ÎÂ¶ÈÖµ
 897   1        conversion_t();               // ÊýÖµ×ª»»
 898   1        EA=1;
 899   1        TR0=1;
 900   1      }
 901          
 902          
 903          
 904          /*=====================================================================================
 905           º¯ÊýÃû³Æ£º»­Ãæ¹¹Ôì
 906           ¹¦ÄÜÃèÊö£º½çÃæ1¡¢2¡¢3£¬Í¼Æ¬²Ëµ¥£¬·´°×£¬±êÍ·£¬16*16£¨32£©Í¼Æ¬
 907           È«¾Ö±äÁ¿£ºÎÞ
 908           ²ÎÊýËµÃ÷£ºº¯ÊýËµÃ÷
 909           ·µ»ØËµÃ÷£ºÎÞ
 910           Éè ¼Æ ÈË£ºLIJH
 911           °æ    ±¾£º1.0
 912           Ëµ    Ã÷£ºX×ø±êÃ¿Ò»¸ñÃ¿´Î16µã
 913           ======================================================================================*/
 914          
 915          
 916          /*·´°×»òÏÔÊ¾Í¼Æ¬ ²ÎÊý¸ñÊ½£º(H)8bitÊý¾Ý£¬(L)8bitÊý¾Ý,X0×ø±ê(16bit)£¬Y0×ø±ê(1bit),X×ø±ê(16bit)£¬Y×ø±ê(1bit)*
             -/
 917          void con_disp (uchar data1,uchar data2,uchar x0,uchar y0,uchar xl,uchar yl)
 918          {
 919   1        uchar i,j;
 920   1        for(j=0;j<yl;j++)
 921   1        {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 16  

 922   2          for(i=0;i<xl;i++)
 923   2          {
 924   3            wr_lcd(comm,0x34);     // À©Õ¹¹¦ÄÜ
 925   3            wr_lcd(comm,y0+j);         // Ð´Y×ø±ê
 926   3            wr_lcd(comm,x0+i);         // Ð´X×ø±ê
 927   3            wr_lcd(comm,0x30);         // ÆÕÍ¨¹¦ÄÜ
 928   3            wr_lcd(dat,data1);
 929   3            wr_lcd(dat,data2);
 930   3          }
 931   2        }
 932   1        wr_lcd(comm,0x36);             // ¿ª»æÍ¼ÏÔÊ¾
 933   1      }
 934          
 935          
 936          
 937          /*ÏÔÊ¾×ÖÌå ²ÎÊý¸ñÊ½: ÏÔÊ¾Î»ÖÃ(0x80-0x9f),ÏÔÊ¾¸öÊý£¬ÏÔÊ¾ÄÚÈÝÖ¸Õë*/
 938          void display_cnasc(uchar dis_bit,uchar num,uchar *cnasc)
 939          {
 940   1        wr_lcd(comm,0x30);         // ÆÕÍ¨¹¦ÄÜ
 941   1        wr_lcd(comm,dis_bit);      // Ð´µØÖ·
 942   1        while(num>0)
 943   1        {
 944   2          wr_lcd(dat,*(cnasc++));
 945   2          wr_lcd(dat,*(cnasc++));
 946   2              num--; 
 947   2        }
 948   1      }
 949          
 950          
 951          
 952          /*µ¼º½±êÍ·ÏÔÊ¾*/
 953          void dis_title(void)
 954          {
 955   1        display_cnasc(0x80,1,"\x15 ");
 956   1        display_cnasc(0x90,1,"©³");
 957   1        display_cnasc(0x97,1,"©·");
 958   1        display_cnasc(0x98,1,"©»");
 959   1        display_cnasc(0x9f,1,"©¿");
 960   1        display_cnasc(0x92,1,"\x1e ");
 961   1        display_cnasc(0x9a,1,"\x1f ");
 962   1        con_disp(0xff,0xff,0x80,0x80,3,16);
 963   1        con_disp(0xef,0xef,0x83,0x80,1,16);
 964   1        con_disp(0xde,0xf7,0x84,0x80,1,16);
 965   1        con_disp(0x76,0xdb,0x85,0x80,1,16);
 966   1        con_disp(0x55,0x55,0x86,0x80,1,16);
 967   1        con_disp(0x55,0x55,0x87,0x80,1,16);   
 968   1      }
 969          
 970          
 971          /*Í¼Æ¬ÏÔÊ¾±êÍ·*/
 972          void dis_title_pic(void)
 973          {
 974   1        display_cnasc(0x80,2,"¡þ¡þ");
 975   1        display_cnasc(0x86,2,"¡þ¡þ");
 976   1      }
 977          
 978          
 979          /*¹¦ÄÜÊµÏÖÏÔÊ¾±êÍ·*/
 980          void dis_title_e(void)
 981          {
 982   1        display_cnasc(0x80,1," \x15");
 983   1        con_disp(0xff,0xff,0x80,0x80,1,16);
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 17  

 984   1        con_disp(0xff,0xc7,0x81,0x80,1,16);
 985   1        con_disp(0xff,0xff,0x82,0x80,3,16);
 986   1        con_disp(0xe3,0xff,0x85,0x80,1,16);
 987   1        con_disp(0xff,0xff,0x86,0x80,2,16);
 988   1      }
 989          
 990          
 991          
 992          /*ÏÔÊ¾²Ëµ¥Í¼Æ¬  ¸ñÊ½£ºÍ¼Æ¬·´ÏÔ(1)»òÕý³£ÏÔÊ¾(0)£¬ÏÔÊ¾Í¼Æ¬µÄºÅÂë*/
 993          void anti_nor_pic (uchar cpl_sign,uchar menu_num)
 994          {
 995   1        uchar i,j,x,y;
 996   1        x=menu_num*3;    // ¼ÆËãÍ¼Æ¬ÏÔÊ¾×ø±ê
 997   1        if(x>6) x--;
 998   1        if(menu_num<3) y=16;  // ÉÏÏÂ°ëÆÁÏÔÊ¾
 999   1        else y=8;
1000   1        if(cpl_sign==1) display_cnasc(0x82,4,menu_cn[menu_num]);
1001   1        for(j=0;j<24;j++)
1002   1        {
1003   2         for(i=0;i<2;i++)
1004   2         {
1005   3           wr_lcd(comm,0x34);
1006   3           wr_lcd(comm,0x80+y);
1007   3           wr_lcd(comm,0x80+x+i);  // ·ÖÁ½´ÎÏÔÊ¾ 16bit
1008   3           wr_lcd(comm,0x30);
1009   3           if(cpl_sign==1)          // Í¼Æ¬·´Ñ¡
1010   3           {
1011   4                 wr_lcd(dat,~menu_pic[menu_num][j*4+i*2]);
1012   4             wr_lcd(dat,~menu_pic[menu_num][j*4+i*2+1]);
1013   4               }
1014   3           else                                         // Õý³£ÏÔÊ¾
1015   3           {
1016   4                 wr_lcd(dat,menu_pic[menu_num][j*4+i*2]);
1017   4             wr_lcd(dat,menu_pic[menu_num][j*4+i*2+1]);
1018   4               }
1019   3         }
1020   2         y++;
1021   2         if(y==32&&menu_num<3) {x+=8;y=0;}  // ÉÏÏÂÆÁÇÐ»»
1022   2        }
1023   1        wr_lcd(comm,0x36);
1024   1      }
1025          
1026          
1027          
1028          
1029          /*×´Ì¬16*16Í¼Æ¬  ¸ñÊ½£º·´É«£¨1£©»òÕý³£0£¬X×ø±ê£¬Y×ø±ê£¬×´Ì¬±àÂë£¨16*16£©*/
1030          void dis_run_state(uchar cpl,uchar x0,uchar y0,uchar state_num)
1031          {
1032   1        uchar j;
1033   1        for(j=0;j<16;j++)
1034   1        {
1035   2          wr_lcd(comm,0x34);  // À©Õ¹¹¦ÄÜ
1036   2          wr_lcd(comm,y0++);  // Ð´YµØÖ·
1037   2          wr_lcd(comm,x0);    // Ð´XµØÖ·
1038   2          wr_lcd(comm,0x30);  // ÆÕÍ¨¹¦ÄÜ
1039   2              if(cpl==1)                      // Ð´Êý¾Ý
1040   2          {
1041   3                wr_lcd(dat,~running[state_num][j*2]);
1042   3            wr_lcd(dat,~running[state_num][j*2+1]);
1043   3              }
1044   2              else
1045   2              {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 18  

1046   3                wr_lcd(dat,running[state_num][j*2]);
1047   3            wr_lcd(dat,running[state_num][j*2+1]);
1048   3              }
1049   2        }
1050   1        wr_lcd(comm,0x36);
1051   1      }
1052          
1053           
1054          
1055           /*ÏÔÊ¾²Ëµ¥°´Å¥  ²ÎÊý¸ñÊ½£º·´É«(1)»òÕý³£(0)*/
1056          void dis_menu_key(uchar d)
1057          {
1058   1        if(d==1)
1059   1        {
1060   2          for(d=0;d<8;d++)                                                              // ÏÔÊ¾²Ëµ¥°´Å¥
1061   2            con_disp(~menu_key[d*2],~menu_key[d*2+1],0x9f,0x97+d,1,1);
1062   2        }
1063   1        else
1064   1        {
1065   2          for(d=0;d<8;d++)                                                              // ÏÔÊ¾²Ëµ¥°´Å¥
1066   2            con_disp(menu_key[d*2],menu_key[d*2+1],0x9f,0x97+d,1,1);
1067   2        }
1068   1      }
1069          
1070          
1071          
1072          
1073          /*ÏÔÊ¾Ä£Ê½3µÄ½çÃæ*/
1074          void dis_mode3(void)
1075          {
1076   1        uchar i,j,h,l,x_0=0x80,y_0=0x90;
1077   1        h=now.hour>>4;       // ·ÖÀëÊ®Î» ¸öÎ»
1078   1        l=now.hour&0x0f;
1079   1        for(j=0;j<2;j++)
1080   1        {
1081   2          for(i=0;i<32;i++)  // Ê®Î»¸öÎ»Ò»Æð¶ÁÈë
1082   2          { 
1083   3            wr_lcd(comm,0x34);
1084   3            wr_lcd(comm,y_0++);
1085   3            wr_lcd(comm,x_0);
1086   3            wr_lcd(comm,0x30);
1087   3            wr_lcd(dat,mode_3num[h][i*3]);  // Á¬ÐøÐ´Êý¾Ý£¬X×ø±ê×Ô¶¯¼Ó1
1088   3            wr_lcd(dat,mode_3num[h][i*3+1]);
1089   3            wr_lcd(dat,mode_3num[h][i*3+2]);
1090   3            wr_lcd(dat,mode_3num[l][i*3]);
1091   3            wr_lcd(dat,mode_3num[l][i*3+1]);
1092   3            wr_lcd(dat,mode_3num[l][i*3+2]); 
1093   3            if(y_0==0xa0){x_0=x_0+8;y_0=0x80;}
1094   3          }
1095   2          x_0=0x84,y_0=0x90;
1096   2          h=now.minute>>4;   // ·ÖÀëÊ®Î» ¸öÎ»
1097   2          l=now.minute&0x0f;
1098   2        }
1099   1        dis_run_state(0,0x83,0x90,4); // ÏÔÊ¾µã
1100   1        dis_run_state(0,0x8b,0x80,4);                                    
1101   1        y_0=0x80;                        // ÏÔÊ¾×´Ì¬±ê¼Ç
1102   1        if(keb) {dis_run_state(0,0x87,y_0,2);y_0+=16;}
1103   1        if(alm) {dis_run_state(0,0x87,y_0,1);y_0+=16;}
1104   1        if(y_0<0xa0&&!als){dis_run_state(0,0x87,y_0,0);}
1105   1        if(y_0==0xa0&&!als){dis_run_state(0,0x8f,0x80,0);}
1106   1        dis_menu_key(0);
1107   1      }
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 19  

1108          
1109          
1110          
1111          
1112          /*ÏÔÊ¾Ä£Ê½1ºÍ2µÄ¹²ÓÃ²¿·Ö*/
1113          void mode1_2_union(void)
1114          {
1115   1        uchar x=0x9b;
1116   1        display_cnasc(0x98,2,"ÐÇÆÚ");
1117   1        if(nba_tim) dis_run_state(0,x,0x90,6);
1118   1        if(keb) {dis_run_state(0,x,0x90,2);x++;}    // ÏÔÊ¾±ê¼Ç
1119   1        if(alm) {dis_run_state(0,x,0x90,1);x++;}
1120   1        if(!als){dis_run_state(0,x,0x90,0);}
1121   1        dis_menu_key(0);                           // ÏÔÊ¾²Ëµ¥°´Å¥
1122   1      }
1123          
1124          
1125          /*ÏÔÊ¾Ä£Ê½2µÄÈÕÆÚ*/
1126          void dis_date_mode2(uchar d)
1127          {
1128   1        uchar save[2];
1129   1        display_cnasc(d+2,1,"Äê");
1130   1        display_cnasc(d+4,1,"ÔÂ");
1131   1        display_cnasc(d+6,1,"ÈÕ");
1132   1        display_cnasc(0x9a,1,weeks[today.week]);  // ÏÔÊ¾ÐÇÆÚ
1133   1        save[0]=char_num[today.year>>4];              // ½«ÏÔÊ¾µÄÊýÖµ´æµ½Êý×éÖÐ
1134   1        save[1]=char_num[today.year&0x0f];
1135   1        display_cnasc(d+1,1,save);
1136   1        save[0]=char_num[today.month>>4];
1137   1        save[1]=char_num[today.month&0x0f];
1138   1        display_cnasc(d+3,1,save);
1139   1        save[0]=char_num[today.day>>4];
1140   1        save[1]=char_num[today.day&0x0f];
1141   1        display_cnasc(d+5,1,save);
1142   1      }
1143          
1144          /*ÏÔÊ¾Ä£Ê½2µÄÊ±¼äÊý×ÖÏÔÊ¾  16*32*/
1145          void num2_asc_dis(uchar num,uchar x_0)
1146          {
1147   1        uchar i,y_0=0x90;
1148   1        for(i=0;i<32;i++)  // Ê®Î»¸öÎ»Ò»Æð¶ÁÈë
1149   1        { 
1150   2          wr_lcd(comm,0x36);
1151   2          wr_lcd(comm,y_0++);
1152   2          wr_lcd(comm,x_0);
1153   2          wr_lcd(comm,0x30);
1154   2          wr_lcd(dat,mode_2num[num][i*2]);
1155   2          wr_lcd(dat,mode_2num[num][i*2+1]);
1156   2              if(i==15){x_0+=8;y_0=0x80;}
1157   2        }
1158   1        wr_lcd(comm,0x36);
1159   1      }
1160          
1161          /*ÏÔÊ¾Ä£Ê½2µÄÊ±¼ä*/
1162          void dis_time_mode2(void)
1163          {
1164   1        uchar h,l;
1165   1        if(now.hour!=save_time.hour||init_d2)
1166   1        {
1167   2          h=now.hour>>4;    // ·ÖÀëÊ®Î» ¸öÎ»
1168   2          l=now.hour&0x0f;
1169   2          num2_asc_dis(h,0x80);
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 20  

1170   2              num2_asc_dis(l,0x80+1);
1171   2        }
1172   1        if(now.minute!=save_time.minute||init_d2)
1173   1        {
1174   2          h=now.minute>>4;    // ·ÖÀëÊ®Î» ¸öÎ»
1175   2          l=now.minute&0x0f;
1176   2          num2_asc_dis(h,0x83); 
1177   2              num2_asc_dis(l,0x83+1);
1178   2        }
1179   1        if(now.second!=save_time.second||init_d2)
1180   1        {
1181   2          h=now.second>>4;    // ·ÖÀëÊ®Î» ¸öÎ»
1182   2          l=now.second&0x0f;
1183   2          num2_asc_dis(h,0x86);
1184   2              num2_asc_dis(l,0x86+1);
1185   2        }
1186   1        if(init_d2)
1187   1        {
1188   2          dis_run_state(0,0x82,0x90,5); // ÏÔÊ¾µã
1189   2          dis_run_state(0,0x8a,0x80,5);
1190   2          dis_run_state(0,0x85,0x90,5); // ÏÔÊ¾µã
1191   2          dis_run_state(0,0x8d,0x80,5);
1192   2        }     
1193   1      }
1194          
1195          
1196          /*ÏÔÊ¾Ä£Ê½2µÄ½çÃæ*/
1197          void dis_mode2(void)
1198          {
1199   1        dis_date_mode2(0x81);       // ÏÔÊ¾ÈÕÆÚ
1200   1        display_cnasc(0x81,1,"20");
1201   1        dis_time_mode2();                       // ÏÔÊ¾Ê±¼ä
1202   1        mode1_2_union();
1203   1      }
1204          
1205          
1206          /*ÏÔÊ¾Ä£Ê½1µÄÈÕÆÚ*/
1207          void dis_date_mode1(void)
1208          {
1209   1        uchar save[2];
1210   1        display_cnasc(0x80,3,"ÈÕÆÚ£º"); 
1211   1        display_cnasc(0x90,3,"Ê±¼ä£º"); 
1212   1        display_cnasc(0x88,3,"ÎÂ¶È£º");
1213   1        display_cnasc(0x9a,1,weeks[today.week]);  // ÏÔÊ¾ÐÇÆÚ
1214   1        display_cnasc(0x83,1,"20");
1215   1        save[0]=char_num[today.year>>4];                        
1216   1        save[1]=char_num[today.year&0x0f];
1217   1        display_cnasc(0x84,1,save);
1218   1        save[0]='/';
1219   1        save[1]=char_num[today.month>>4];
1220   1        display_cnasc(0x85,1,save);
1221   1        save[0]=char_num[today.month&0x0f];
1222   1        save[1]='/';
1223   1        display_cnasc(0x86,1,save);
1224   1        save[0]=char_num[today.day>>4];
1225   1        save[1]=char_num[today.day&0x0f];
1226   1        display_cnasc(0x87,1,save);
1227   1        mode1_2_union();
1228   1      }
1229          
1230          
1231          /*ÏÔÊ¾Ä£Ê½1µÄÊ±¼ä*/
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 21  

1232          void dis_time_mode1(void)
1233          {
1234   1        uchar save[2];
1235   1        save[0]=char_num[now.hour>>4];
1236   1        save[1]=char_num[now.hour&0x0f];
1237   1        display_cnasc(0x93,1,save);
1238   1        save[0]=':';
1239   1        save[1]=char_num[now.minute>>4];
1240   1        display_cnasc(0x94,1,save);
1241   1        save[0]=char_num[now.minute&0x0f];
1242   1        save[1]=':';
1243   1        display_cnasc(0x95,1,save);
1244   1        save[0]=char_num[now.second>>4];
1245   1        save[1]=char_num[now.second&0x0f];
1246   1        display_cnasc(0x96,1,save);
1247   1      }
1248          
1249          
1250          /*ÏÔÊ¾Ä£Ê½1µÄÎÂ¶È*/
1251          void dis_temp_mode1(void)
1252          {
1253   1        uchar save[2];
1254   1        if(ds18b20)
1255   1        {
1256   2               if(temp.t_data[0]>99)
1257   2               {
1258   3                  save[0]=char_num[temp.t_data[0]/100];
1259   3                      save[1]=char_num[(temp.t_data[0]/10)%10];
1260   3                      display_cnasc(0x8b,1,save);
1261   3                      save[0]=char_num[temp.t_data[0]%10];
1262   3                      save[1]='.';
1263   3                      display_cnasc(0x8c,1,save);
1264   3                      save[0]=char_num[temp.t_data[1]/10];
1265   3                      save[1]=' ';
1266   3                      display_cnasc(0x8d,1,save);
1267   3                      display_cnasc(0x8e,1,"¡æ");
1268   3                }
1269   2                else
1270   2                {
1271   3              if(temp_pn) display_cnasc(0x8a,1,":-");
1272   3                  else  display_cnasc(0x8a,1,"£º");
1273   3                      save[0]=char_num[temp.t_data[0]/10];
1274   3                      save[1]=char_num[temp.t_data[0]%10];
1275   3                      display_cnasc(0x8b,1,save);
1276   3                      save[0]='.';
1277   3                      save[1]=char_num[temp.t_data[1]/10];
1278   3                      display_cnasc(0x8c,1,save);
1279   3                      display_cnasc(0x8d,1,"¡æ");
1280   3                }
1281   2              }
1282   1        else display_cnasc(0x8b,3,"FF.F¡æ");
1283   1      }
1284          
1285          
1286          
1287          /*ÏÔÊ¾Ä£Ê½1µÄ½çÃæ*/
1288          void dis_mode1(void)
1289          {
1290   1        dis_date_mode1(); 
1291   1        dis_time_mode1();
1292   1        dis_temp_mode1();
1293   1      }
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 22  

1294          
1295          
1296          
1297          /*ÀºÇòÆ÷Ê±¼äÏÔÊ¾*/
1298          void nba_dis_time(void)
1299          {
1300   1        uchar d,dis[2];
1301   1        for(d=2;d<4;d++)
1302   1        {
1303   2              dis[0]=char_num[resu[d]/10];
1304   2              dis[1]=char_num[resu[d]%10];
1305   2              display_cnasc(0x81+d*2,1,dis);
1306   2        }
1307   1        display_cnasc(0x86,1,": ");
1308   1        if(resu[0]==1)
1309   1        {
1310   2              dis[0]='\x07';
1311   2              dis[1]=char_num[resu[4]/10];
1312   2              display_cnasc(0x93,1,dis);
1313   2              dis[1]='\x07';
1314   2              dis[0]=char_num[resu[4]%10];
1315   2              display_cnasc(0x94,1,dis);
1316   2        }
1317   1      }
1318          
1319          
1320          /*=====================================================================================
1321           º¯ÊýÃû³Æ£º¼üÅÌÉ¨Ãè
1322           ¹¦ÄÜÃèÊö£º¶ÁÈ¡¼üÅÌ²Ù×÷Êý¾Ý¼°²¿·Ö×´Ì¬µÄÊµÏÖ
1323           È«¾Ö±äÁ¿£ºdis_sig  t0_isr  temprun  b20time  alm_run als_temp   buzstop  als
1324                     lock_op  nba_tim 
1325           ²ÎÊýËµÃ÷£ºÎÞ
1326           ·µ»ØËµÃ÷£º¼üÅÌËøÓëÃÜÂëËøÊ±¼äµ½´ïºó·µ»Ø 255
1327           Éè ¼Æ ÈË£ºLIJH
1328           °æ    ±¾£º1.0
1329           Ëµ    Ã÷£º
1330           ======================================================================================*/
1331          
1332          /*É¨Ãè¼üÅÌ*/
1333          uchar  keypad_scan()
1334          {
1335   1        uchar key,dis[2];
1336   1        keyboard=0xf0;
1337   1        while (keyboard==0xf0)     // µÈ´ý°´¼ü°´ÏÂ
1338   1        {      
1339   2       
1340   2        /*--------------------- ±³¹âµÆ¹Ø±ÕÑÓÊ± -----------------------*/
1341   2              
1342   2              delay(1000);                                 
1343   2              if((++dis[0])==0&&bl_delay!=0) bl_delay--;  // µ±ÓÐ°´¼ü°´ÏÂbl_delayÖØÐÂ¸³Öµ     
1344   2              if(bl_delay==0&&!bl0) lcd_bl=close;         // ±³¹âÊ±¼äµ½ÇÒ²»ÊÇ³£¿ªÄ£Ê½Ê±¹Ø±Õ±³¹â
1345   2      
1346   2                
1347   2        /*----------------------- ¼üÅÌËøÑÓÊ± -------------------------*/      
1348   2      
1349   2              if(keb&&dis_sig&&bl_delay==0&&resu[11]<2) resu[11]++; // µ±ÓÐ°´¼ü°´ÏÂjÇåÁã
1350   2              if(bl_delay==0) bl_delay=15; 
1351   2      
1352   2      
1353   2        /*--------------------- ÃÜÂëËø30ÃëËøÑÓÊ± ---------------------*/              
1354   2      
1355   2              if(lock_op)                                      
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 23  

1356   2              {
1357   3                if((++i)==0) save1++;         
1358   3                if(save1==15) return(255);
1359   3              }
1360   2              
1361   2      
1362   2        /*---------------------- Ê±ÖÓ½çÃæÊ±¼äÏÔÊ¾ ---------------------*/
1363   2              
1364   2              if(dis_sig&&t0_isr||nba_tim&&oth_run)     // Õý³£Ê±ÖÓ½çÃæÓëÀºÇòÆ÷·µ»ØÊ±ÖÓ½çÃæÏÔÊ¾
1365   2          {    
1366   3                rds1302_date();           // ¶Á³öÈÕÆÚ 
1367   3            rds1302_time();           // ¶Á³öÊ±¼ä
1368   3                if(di0)                   // Ä£Ê½2
1369   3                {
1370   4                  dis_time_mode2(); 
1371   4                      if(now.hour==0&&now.minute==0&&now.second==0)   dis_date_mode2(0x81); 
1372   4                }
1373   3            else if(di1)                      // Ä£Ê½3
1374   3                { 
1375   4                  if(now.hour!=save_time.hour||now.minute!=save_time.minute)   // Ê±,·Ö±ä»¯ºóÏÔÊ¾
1376   4                    dis_mode3();         
1377   4            }
1378   3            else 
1379   3                {
1380   4                  dis_time_mode1();   // Ä£Ê½1
1381   4                  if(now.hour==0&&now.minute==0&&now.second==0) dis_date_mode1();
1382   4                }
1383   3                save_time=now;        // ÖØÐÂ¼ÇÂ¼×÷ÏÂ´Î±È½Ï
1384   3                t0_isr=0;
1385   3              }
1386   2        
1387   2        
1388   2        /*-------------------- ÎÂ¶È¼ÆÌáÊ¾°´¼ü²Ù×÷ ----------------------*/
1389   2              
1390   2              if(temprun)
1391   2              {
1392   3                if(!oth_run)
1393   3                {
1394   4                  display_cnasc(0x96,2," key");    // ÎÂ¶È¼ÆÊ±ÌáÊ¾°´¼ü²Ù×÷
1395   4                      for(dis[1]=0;dis[1]<250;dis[1]++)
1396   4                  {
1397   5                    delay(1000);
1398   5                        if(keyboard!=0xf0)
1399   5                        {
1400   6                          keyboard=0x7f;
1401   6                              if(keyboard==0x7d) return 0x7d;
1402   6                              else  keyboard=0xf0;
1403   6                        }
1404   5                  }
1405   4                      oth_run=1;
1406   4                      display_cnasc(0x96,2,"    ");
1407   4                }
1408   3              }
1409   2        
1410   2        
1411   2         /*------------------------ ·äÃùÆ÷¾¯±¨ --------------------------*/
1412   2      
1413   2              
1414   2              if(((alm_run&&alm)||thl_als)&&!buzstop) // ÎÂ¶È£¬ÄÖÁå·äÃùÆ÷¾¯±¨
1415   2              {                                                                           // ÓÐ°´¼ü°´ÏÂÊ±Í£Ö¹
1416   3                if(now.second==0)     lcd_bl=close;
1417   3                delay(15000);                                                 // ¶Á³öÎÂ¶ÈÊ±¼ä±È½Ï
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 24  

1418   3                if(keyboard!=0xf0) break;
1419   3                delay(15000);
1420   3                if(keyboard!=0xf0) break;
1421   3                delay(15000);
1422   3                if(keyboard!=0xf0) break;
1423   3                delay(15000);
1424   3                if(alm_run)  lcd_bl=!lcd_bl;                  // Ö»ÔÚÄÖÁå¹¦ÄÜÉÁ
1425   3                if(!als)buzzer=!buzzer;               // ¾¯±¨¿ªÆôºó·äÃùÆ÷¿ªÆô                     
1426   3              } 
1427   2      
1428   2      
1429   2        /*----------------------- ÎÂ¶ÈË¢ÐÂÏÔÊ¾ -------------------------*/
1430   2      
1431   2              
1432   2              if((temprun&&oth_run)||(b20time&&!di0&&!di1&&dis_sig))    // ÎÂ¶È¼Æ¹¦ÄÜÓÚÄ£Ê½1½çÃæ 
1433   2          {  
1434   3               
1435   3                  ds18b20_func();                                               // ÎÂ¶È¼ì²â¹¦ÄÜ
1436   3                      oth_run=0;                                // ×÷½»Ìæ±ê¼ÇÓÃ
1437   3                  if(temprun) return 20;                            // ÎÂ¶È¼Æ¿ªÆôºó·µ»Ø
1438   3                  if(b20time){ dis_temp_mode1();b20time=0;} // Ê±ÖÓ½çÃæ5·ÖÖÓ¸üÐÂÒ»´Î£¬T0¼ÆÊ±
1439   3          } 
1440   2      
1441   2        
1442   2         
1443   2         /*------------------------ ÀºÇòÆ÷ÏÔÊ¾Ê±¼ä ------------------------*/
1444   2              
1445   2              if(nba_tim&!oth_run)        // µ±ÀºÇòÆ÷Ä£Ê½ÏÂ oth_run==0ÎªÀºÇòÆ÷¼ÆÊ±×´Ì¬ 
1446   2              {
1447   3                if(EA) display_cnasc(0x8b,2," R\x10 ");  // ÏÔÊ¾ÔËÐÐ×´Ì¬
1448   3                else  display_cnasc(0x8b,2," S! ");
1449   3                if(t0_isr)
1450   3                {                                                                                // ¸üÐÂÊ±¼ä
1451   4                  nba_dis_time();
1452   4                      if(resu[2]==0&&resu[3]==0)                         // ÅÐ¶Ï±ÈÈüÇé¿ö 
1453   4                      {
1454   5                        resu[6]++;
1455   5                        if(resu[6]<resu[1])  display_cnasc(0x85,3,"ÐÝÏ¢  ");
1456   5                        else  display_cnasc(0x85,3,"Íê½á  ");
1457   5                      }
1458   4                      if(resu[4]==0||(resu[2]==0&&resu[3]==0))  // Ê±¼äµ½´ï¾¯±¨
1459   4                  {
1460   5                     buzzer=open;
1461   5                     delay_pw();
1462   5                         if(resu[2]==0&&resu[3]==0)  // 24Ãë ×ÜÊ±¼ä¾¯±¨
1463   5                         {
1464   6                           delay_pw();
1465   6                         }
1466   5                     buzzer=close;
1467   5                         if(resu[4]==0) resu[4]=24;  // ÖØÐÂ¸³Öµ
1468   5                  }
1469   4                  t0_isr=0;                                      // ÇåÁãµÈÏÂ´ÎÖÐ¶Ï²úÉú
1470   4                }
1471   3              }
1472   2        }
1473   1      
1474   1                                
1475   1                                      /*===== ÒÔÉÏµÈ´ý°´¼ü =====*/
1476   1      
1477   1      
1478   1      
1479   1        /*------------------------- °´¼ü°´ÏÂºó --------------------------*/
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 25  

1480   1      
1481   1        
1482   1        delay(8000);               // Ïû¶¶Õñ
1483   1        if(!lock_op)bl_delay=15;   // ±³¹âÊ±¼ä¸³Öµ 
1484   1        if(bl1) lcd_bl=close;      // ²»ÔÚ±³¹âµÆ¹Ø±ÕÊ±ÁÁÆð
1485   1        else lcd_bl=open;
1486   1        if(alm_run|thl_als) {buzstop=1;buzzer=close;}
1487   1        if(keb&&dis_sig) 
1488   1        {
1489   2          if(resu[11]==2) return 255;  // ÒªÇóÊäÈëÃÜÂë        
1490   2              else resu[11]=0;                         // Ê±¼ä²»µ½Ê±ÖØÐÂ¼ÆÊ±
1491   2        }
1492   1        do
1493   1        {     
1494   2              for(dis[0]=0;dis[0]<=3;dis[0]++)
1495   2          {
1496   3            keyboard=ksp[dis[0]];
1497   3                if(keyboard!=ksp[dis[0]])
1498   3            { 
1499   4              key=keyboard;
1500   4              if(key!=ksp[dis[0]]) return(key);
1501   4            }
1502   3          }
1503   2        }while(1);
1504   1      } 
1505           
1506          
1507          /*¶Á¼üÅÌÊý¾Ý*/
1508          uchar  gotkey()
1509          {
1510   1        uchar  save,n;
1511   1        keyboard=0xf0;
1512   1        while(keyboard!=0xf0);    // µÈ´ý¼üÅÌËÉ¿ª
1513   1        delay(5000);              // Ïû¶¶Õó
1514   1        if(adju_si)               // Á¬Ð´ÊäÈë
1515   1        {
1516   2              adju_si=0;
1517   2              for(n=0;n<60;n++)
1518   2              {
1519   3                delay(2000);
1520   3                if(keyboard!=0xf0)
1521   3                { 
1522   4                  adju_si=1;          // ÔÚ¸ü¸ÄÊ±,ÔÚ´ËÊ±¼äÄÚ¿ÉÁ¬³É¶àÎ»Êý
1523   4                  break;
1524   4                }
1525   3          }
1526   2        }                     
1527   1        save=keypad_scan();       // É¨Ãè¼üÅÌ
1528   1        if(save==255) return 255;     // ÒªÇóÊäÈë¼üÅÌËøÃÜÂë»òÑÓÊ±Ê±¼äµ½´ï
1529   1        for (n=0;n<16;n++)
1530   1        {  
1531   2              if(save==key_code[n]) 
1532   2                 return(n);
1533   2        }
1534   1        return(20);
1535   1      }
1536          
1537          
1538          
1539          /*=====================================================================================
1540           º¯ÊýÃû³Æ£ºµ¼º½
1541           ¹¦ÄÜÃèÊö£ºÖ÷²Ëµ¥ ¹¤¾ßµ¼º½  ±£´æÌáÊ¾
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 26  

1542           È«¾Ö±äÁ¿£ºÎÞ
1543           ²ÎÊýËµÃ÷£º
1544           ·µ»ØËµÃ÷£ºÎÞ
1545           Éè ¼Æ ÈË£ºLIJH
1546           °æ    ±¾£º1.0
1547           Ëµ    Ã÷£º
1548           ======================================================================================*/
1549          
1550          
1551          /*°´¼ü°´ÏÂÏÔÊ¾ ²ÎÊý¸ñÊ½£ºk °´Å¥µÄÏÔÊ¾µØÖ·*/
1552          void key_dis(uchar k)
1553          {
1554   1        display_cnasc(k,1,"\x04 ");
1555   1        delay(10000);
1556   1        if(k==0x92||k==0x96) display_cnasc(k,1,"\x1e ");
1557   1        else display_cnasc(k,1,"\x1f ");
1558   1      }
1559          
1560          
1561          
1562          /*È·¶¨°´¼ü°´ÏÂÏÔÊ¾*/
1563          void enter_dis(void)
1564          {
1565   1        display_cnasc(0x8f,1," \x09");
1566   1        delay(15000);
1567   1      }
1568          
1569          
1570          
1571          /*Ö÷²Ëµ¥µ¼º½*/
1572          uchar dis_menu(void)
1573          {
1574   1        uchar d,save,key;
1575   1        if(meu)
1576   1        {  
1577   2          display_cnasc(0x81,2,"²Ëµ¥");
1578   2              dis_title();
1579   2              display_cnasc(0x88,8,selected[0]);
1580   2              con_disp(0xff,0xff,0x8a,0x80,5,16);
1581   2        } 
1582   1        else    // ÏÔÊ¾Í¼Æ¬²Ëµ¥
1583   1        {
1584   2          dis_title_pic();
1585   2              for(d=0;d<6;d++)  
1586   2            anti_nor_pic(0,d);
1587   2              anti_nor_pic(1,0);
1588   2        }      
1589   1        save=d=0;
1590   1        do
1591   1        {
1592   2              if(meu)   // ²Ù×÷Ö¸Ê¾¸üÐÂ
1593   2              {         
1594   3                display_cnasc(0x93,3,menu_cn_2[index_m[save].left_num]);
1595   3                display_cnasc(0x8b,3,menu_cn_2[save]);
1596   3                display_cnasc(0x9b,3,menu_cn_2[index_m[save].right_num]); 
1597   3          }
1598   2              else
1599   2              {
1600   3                anti_nor_pic(0,d);     
1601   3                anti_nor_pic(1,save);
1602   3              }
1603   2              d=save;                       // ±£´æÉÏÒ»Ë÷Òý
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 27  

1604   2              while(1)
1605   2              {
1606   3                key=gotkey();
1607   3                if(key==11||(key==3&&meu))
1608   3                { 
1609   4                  if(meu) enter_dis();
1610   4                      break;
1611   4                }
1612   3                else if(meu)
1613   3                { 
1614   4                  if(key==2)
1615   4                      {
1616   5                        save=index_m[d].right_num;
1617   5                        key_dis(0x9a);
1618   5                        break;
1619   5                      }
1620   4                  if(key==5)
1621   4                      {
1622   5                        save=index_m[d].left_num;
1623   5                        key_dis(0x92);
1624   5                        break;
1625   5                      }
1626   4                      if((key==1&&meu))
1627   4                  {
1628   5                    d=5;
1629   5                        break;
1630   5                  } 
1631   4                }
1632   3                else 
1633   3                {
1634   4                  if(key==3){save=index_m[d].right_num; break;} // ¸ù¾Ýµ¼º½¼üÑ°ÕÒË÷Òý
1635   4                  if(key==1){save=index_m[d].left_num; break;}
1636   4                      if(key==2||key==5){save=index_m[d].shaft_num; break;}  
1637   4            }
1638   3              }
1639   2              if(key==11||((key==1|key==3)&&meu)) break;
1640   2        }while(1);
1641   1        return d;
1642   1      }
1643          
1644          
1645          
1646          /*¹¤¾ßµ¼º½*/
1647          uchar tool_func(void)
1648          {
1649   1        uchar save,d,key;
1650   1        display_cnasc(0x81,2,"¹¤¾ß");
1651   1        dis_title();
1652   1        display_cnasc(0x88,8,selected[0]);
1653   1        con_disp(0xff,0xff,0x8a,0x80,5,16); 
1654   1        d=0;
1655   1        save=0;
1656   1        do
1657   1        {       
1658   2              display_cnasc(0x93,3,tool_menu[index_t[save].lnum]);
1659   2              display_cnasc(0x8b,3,tool_menu[save]);
1660   2              display_cnasc(0x9b,3,tool_menu[index_t[save].rnum]); 
1661   2              d=save;
1662   2              while(1)
1663   2              {
1664   3                key=gotkey();
1665   3                if(key==1){ d=4;break;}                               // ¸ù¾Ý°´¼üÑ°ÕÒË÷Òý
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 28  

1666   3                if(key==11||key==3){enter_dis();break;}
1667   3                if(key==2){save=index_t[d].rnum; key_dis(0x9a);break;}
1668   3                if(key==5){save=index_t[d].lnum; key_dis(0x92);break;}
1669   3          }
1670   2              if(key==11||key==3||key==1) break;
1671   2        }while(1);
1672   1        return d;
1673   1      }
1674          
1675          
1676          
1677          
1678          /*¸ü¸ÄºóÌáÊ¾±£´æ*/
1679          void save_y_or_n(void)
1680          {
1681   1        uchar key;
1682   1        clear_dis();
1683   1        oth_run=0;      
1684   1        display_cnasc(0x92,5,"ÊÇ·ñ±£´æ? ");
1685   1        display_cnasc(0x89,6,"Y(OK)\\N(./S)");
1686   1        while(1)
1687   1        {
1688   2              key=gotkey();
1689   2              if(key==11) 
1690   2              {
1691   3                display_cnasc(0x9a,5,"±£´æ³É¹¦£¡ ");
1692   3                delay(50000);
1693   3                oth_run=1;     // ÒªÇó±£´æÊ±oth_run±ê¼ÇÎª1
1694   3                return;
1695   3              }
1696   2              if(key==10) return;
1697   2        }
1698   1      } 
1699          
1700          
1701          /*=====================================================================================
1702           º¯ÊýÃû³Æ£ºµ÷Õû¹¦ÄÜ
1703           ¹¦ÄÜÃèÊö£ºÊ±¼äÈÕÆÚµ÷Õû
1704           È«¾Ö±äÁ¿£ºtoday  now
1705           ²ÎÊýËµÃ÷£º¼ûº¯Êý
1706           ·µ»ØËµÃ÷£ºÎÞ
1707           Éè ¼Æ ÈË£ºLIJH
1708           °æ    ±¾£º1.0
1709           Ëµ    Ã÷£º
1710           ======================================================================================*/
1711          
1712          
1713          /*µ÷Õû¹¦ÄÜÏÔÊ¾Ê±¼ä*/
1714          void asjust_time()
1715          { 
1716   1        uchar save[2];
1717   1        display_cnasc(0x8a,1,"Ê±");
1718   1        display_cnasc(0x8c,1,"·Ö");
1719   1        display_cnasc(0x8e,1,"Ãë");
1720   1        save[0]=char_num[now.hour>>4];
1721   1        save[1]=char_num[now.hour&0x0f];
1722   1        display_cnasc(0x89,1,save);
1723   1        save[0]=char_num[now.minute>>4];
1724   1        save[1]=char_num[now.minute&0x0f];
1725   1        display_cnasc(0x8b,1,save);
1726   1        save[0]=char_num[now.second>>4];
1727   1        save[1]=char_num[now.second&0x0f];
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 29  

1728   1        display_cnasc(0x8d,1,save);
1729   1      }
1730          
1731          
1732          /*µ÷Õû¹¦ÄÜÔÂÌìÊý±È½Ï*/
1733          uchar monthday(uchar year,uchar month)
1734          {
1735   1        if(month==2&&year%4==0)
1736   1          return(29);
1737   1        else
1738   1        {     year=month&0x0f;
1739   2          month>>=4;
1740   2              month=month*10+year;    
1741   2          return(dayofmonth[month-1]);}
1742   1      }
1743          
1744          
1745          
1746          /*ÐÇÆÚÍÆËã*/
1747          void weeks_day()
1748          { 
1749   1        uchar d,buffer,day=4; 
1750   1        if(today.month>1)
1751   1        {
1752   2          buffer=(today.month>>4);   // ½«BCDÂë×ªÎªÊ®½øÖÆ
1753   2              buffer=buffer*10;
1754   2              buffer+=(today.month&0x0f);
1755   2              for(d=0;d<buffer-1;d++)
1756   2              {
1757   3                today.week=(dayofmonth[d]>>4);
1758   3                today.week=today.week*10;
1759   3                today.week+=(dayofmonth[d]&0x0f);
1760   3            day+=(today.week%7);
1761   3              }
1762   2        }
1763   1        buffer=(today.year>>4);
1764   1        buffer*=10;
1765   1        buffer+=(today.year&0x0f);
1766   1        if(today.year!=0)
1767   1        {
1768   2              day+=((buffer-1)/4)+buffer+1;
1769   2        }
1770   1        if(buffer%4==0&&today.month>2) day++;
1771   1        buffer=today.day>>4;
1772   1        buffer*=10;
1773   1        buffer+=(today.day&0x0f);
1774   1        today.week=(day+buffer)%7;
1775   1      }
1776          
1777          
1778          
1779          /*µ÷Õû¹¦ÄÜ*/
1780          void adjust_func(void)
1781          {
1782   1        uchar d,save,b=0;
1783   1        dis_title_e();
1784   1        display_cnasc(0x82,3,menu_cn_2[0]);
1785   1        rds1302_date();
1786   1        rds1302_time();
1787   1        dis_date_mode2(0x90);
1788   1        display_cnasc(0x9a,1,"  "); 
1789   1        asjust_time();
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 30  

1790   1        display_cnasc(0x9f,1,"¡ú");
1791   1        display_cnasc(0x90,1,"¡º");
1792   1        display_cnasc(0x8f,1,"¡»");
1793   1        d=0;save=0;
1794   1        adju_si=0;
1795   1        do
1796   1        {
1797   2          con_disp(0x00,0x00,index_a[d].lnum,index_a[d].rnum,1,13);
1798   2          con_disp(0xff,0xff,index_a[save].lnum,index_a[save].rnum,1,13);
1799   2              d=save;
1800   2              while(1)
1801   2              {
1802   3                save=gotkey();
1803   3                if(save>=0&&save<10)
1804   3                {
1805   4                  switch(d)
1806   4                  {
1807   5                    case 0: if(adju_si) // adju_si==1Ê±Á½´ÎÊäÈëÁ¬³ÉÒ»¸öÊý
1808   5                                { 
1809   6                                          today.year<<=4;
1810   6                                      today.year+=save;adju_si=0;
1811   6                                        } 
1812   5                            else 
1813   5                                    {
1814   6                                      today.year=save;adju_si=1;
1815   6                                    }
1816   5                                break;
1817   5                        case 1: if(adju_si)
1818   5                                {
1819   6                                          today.month<<=4;today.month+=save;
1820   6                                  if(today.month>0x12) today.month=save;
1821   6                          else adju_si=0;
1822   6                                        }
1823   5                                        else  
1824   5                                        {
1825   6                                          today.month=save;adju_si=1;
1826   6                                        }
1827   5                                        break;
1828   5                        case 2: if(adju_si)
1829   5                                {
1830   6                                          today.day<<=4;today.day+=save;  // ÔÂÌìÊý±È½Ï
1831   6                                              if(today.year%4==0&&today.month==2&&today.day==29) ;
1832   6                                  else if(today.day>monthday(today.year,today.month)) 
1833   6                                                today.day=save;
1834   6                                              else adju_si=0;
1835   6                                        }
1836   5                                        else  {today.day=save;adju_si=1;}
1837   5                                        break;
1838   5                        case 3: if(adju_si)
1839   5                                {
1840   6                                          now.hour<<=4;now.hour+=save;
1841   6                                              if(now.hour>0x23) now.hour=save;
1842   6                                              else adju_si=0;
1843   6                                        }
1844   5                                        else  {now.hour=save;adju_si=1;}
1845   5                                        break;
1846   5                        case 4: if(adju_si)
1847   5                                {
1848   6                                          now.minute<<=4;now.minute+=save;
1849   6                                              if(now.minute>0x59) now.minute=save;
1850   6                                              else adju_si=0;
1851   6                                        }
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 31  

1852   5                                        else  {now.minute=save;adju_si=1;}
1853   5                                        break;
1854   5                        case 5: if(adju_si)
1855   5                                {
1856   6                                          now.second<<=4;now.second+=save;
1857   6                                              if(now.second>0x59) now.second=save;
1858   6                                              else adju_si=0;
1859   6                                        }
1860   5                                        else  {now.second=save;adju_si=1;}
1861   5                                        break;
1862   5                      }
1863   4                      if(today.day>monthday(today.year,today.month)) today.day=1;     // ¸ü¸ÄÔÂ·ÝÊ±ÅÐ¶ÏÌìÊý
1864   4                      if(today.month==0) today.month=1;
1865   4                      if(today.day==0) today.day=1;
1866   4                      if(d<3) dis_date_mode2(0x90);   // ¸üÐÂÏÔÊ¾
1867   4              else asjust_time();
1868   4                      display_cnasc(0x9a,1,"  ");             // ÏûÈ¥ÐÇÆÚÏÔÊ¾
1869   4            }
1870   3                if(save==11){save=d+1;adju_si=0;break;}
1871   3                if(save==10&&d!=0){save=d-1;adju_si=0;break;}
1872   3              }
1873   2          if(save==7&d==6) break;
1874   2        }while(1);
1875   1        weeks_day();    // ¼ÆËãÐÇÆÚ
1876   1        save_y_or_n();  // ÐèÒª±£´æÊ±oth_runÉèÎª1
1877   1        if(oth_run) wds1302_time_date();
1878   1      }
1879          
1880          
1881          
1882          
1883          /*=====================================================================================
1884           º¯ÊýÃû³Æ£º¼ÆËãÆ÷¹¦ÄÜ
1885           ¹¦ÄÜÃèÊö£º10Î»´ø·ûºÅÊýµÄ¼Ó¼õ³Ë³ýÔËËã
1886           È«¾Ö±äÁ¿£ºopera  resu  i  j
1887           ²ÎÊýËµÃ÷£º¼ûº¯Êý
1888           ·µ»ØËµÃ÷£ºÎÞ
1889           Éè ¼Æ ÈË£ºLIJH
1890           °æ    ±¾£º1.0
1891           Ëµ    Ã÷£º
1892           ======================================================================================*/
1893          
1894          
1895          
1896          /*Çå¼Ä´æÆ÷  ²ÎÊý¸ñÊ½£ºm=2Ê±½á¹û¼Ä´æÆ÷£¬µ±m=1Ê±²Ù×÷Êý1£¬µ±m=0Ê±²Ù×÷Êý0(1),
1897                                  n=1Ê±,Ö»Çå¼Ä´æÆ÷²»ÇåÏÔÊ¾, 0Á½Çå*/
1898          void removal_data(uchar m,uchar n)
1899          {
1900   1        uchar l;              // µ±n=1Ê±,Ö»Çå¼Ä´æÆ÷²»ÇåÏÔÊ¾, 0Á½Çå
1901   1        if(m==2)              // µ±m=2Ê±½á¹û¼Ä´æÆ÷
1902   1        {                         // µ±m=1Ê±²Ù×÷Êý1
1903   2          if(n==0)    // µ±m=0Ê±²Ù×÷Êý0 ,1
1904   2                for(l=0;l<6;l++)
1905   2                  display_cnasc(0x98+l,1,"  ");
1906   2          for(l=0;l<12;l++)
1907   2            resu[l]=0;
1908   2        }
1909   1        while(m<2)
1910   1        { 
1911   2          if(n==0)
1912   2              {
1913   3                if(m==0) 
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 32  

1914   3                {  
1915   4                  for(l=0;l<6;l++)
1916   4                    display_cnasc(0x90+l,1,"  ");
1917   4                        display_cnasc(0x95,1," 0");
1918   4                }     
1919   3                else
1920   3                   for(l=0;l<6;l++)
1921   3                      display_cnasc(0x88+l,1,"  ");
1922   3              }
1923   2          for(l=0;l<12;l++)
1924   2            opera[m][l]=0;
1925   2              m++;
1926   2        }
1927   1      }
1928          
1929          
1930          
1931          
1932          /*ÏÔÊ¾ÊýÖµ  ²ÎÊý¸ñÊ½£ºÏÔÊ¾Ê×µØÖ·*/
1933          void dis_cdata(uchar ass)
1934          {
1935   1        uchar p,d,save[2];
1936   1        if(i==0&&opera[0][0]==1)              // ÏÔÊ¾·ûºÅ
1937   1        {
1938   2          if(cal_run)  display_cnasc(0x98,1,"=-");
1939   2          else  display_cnasc(0x90,1," -");
1940   2        }
1941   1        d=opera[i][11];                               // ¼ÆËãÎ»Êý
1942   1        if(opera[i][10]!=0&&opera[i][10]!=opera[i][11]+1) d++;
1943   1        save[0]=d/2;ass=ass-save[0]+5;        // ¼ÆËãÏÔÊ¾µÄ¿ªÊ¼Î»ÖÃ
1944   1        p=1;
1945   1        cal_del=0;                                    // ÏÔÊ¾µã±ê¼Ç £¨0ÎªÃ»ÓÐÏÔÊ¾£©
1946   1        if(d%2==1)                                    // ¶ÔÎ»ÊýÎ»ÆæÊýÏÈ´¦ÀíÊ×Î»
1947   1        { 
1948   2          save[0]=' ';
1949   2          save[1]=char_num[opera[i][1]];
1950   2              display_cnasc(ass,1,save);
1951   2              p++;
1952   2        }
1953   1        ass++;                                                // ÏÔÊ¾µØÖ·¼ÓÒ»
1954   1        while(p<=opera[i][11])
1955   1        {                                                                     
1956   2          if(opera[i][10]==p&&(!cal_del)) {   // ÏÔÊ¾µãÇÒ×÷±ê¼Ç
1957   3                save[0]='.';cal_del=1;}
1958   2          else { 
1959   3                save[0]=char_num[opera[i][p]]; p++;}
1960   2          if(opera[i][10]==p&&(!cal_del)) { 
1961   3                save[1]='.';cal_del=1;}
1962   2          else{ 
1963   3                save[1]=char_num[opera[i][p]];p++;}
1964   2          display_cnasc(ass,1,save);
1965   2          ass++;
1966   2        }
1967   1      }   
1968          
1969          
1970          /*´Ó¼üÅÌÖÐÐ´ÈëÊý¾Ý*/   
1971          char input_data()
1972          {
1973   1        uchar save=20,c;
1974   1        for(;i<2;i++)
1975   1        {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 33  

1976   2          while(1)
1977   2          {
1978   3      pp:   save=gotkey();    // ¶Á¼üÅÌ
1979   3                if(save==20) continue;
1980   3                if(save==11)          // °´¼üÎªÈ·¶¨Ê±,Ñ¡Ôñ¼ÆËã»òÉ¾³ý
1981   3                {
1982   4                  c=save=0;
1983   4                      while(1)                // ·´É«Ñ¡Ôñ
1984   4                  { 
1985   5                        con_disp (0x00,0x00,index_cal[save].lnum,index_cal[save].rnum,2,16);
1986   5                        con_disp (0xff,0xff,index_cal[c].lnum,index_cal[c].rnum,2,16);        
1987   5                        save=gotkey();
1988   5                        if(save==10)
1989   5                        { 
1990   6                          save=c;
1991   6                              if(++c==3) c=0;
1992   6                        }
1993   5                        else if(save==11) 
1994   5                        { 
1995   6                  if(c==0) save=11;
1996   6                          else if(c==1) save=16;
1997   6                              else  return 0;
1998   6                          break;
1999   6                        }
2000   5                        else break;
2001   5              }
2002   4                      con_disp (0x00,0x00,index_cal[c].lnum,index_cal[c].rnum,2,16);      
2003   4                }
2004   3            if(save>=0&&save<=9&&j<10) 
2005   3                {
2006   4                  if(i==1&&opera[1][0]==15&&j>8) goto pp;
2007   4              if(j==2&&opera[i][1]==0&&opera[i][10]==0)
2008   4                opera[i][1]=save;             // ·ÀÖ¹Ð¡ÊýÎ»²»ÔÚÊ±Ê×Î»ÎªÁã
2009   4                  else{
2010   5                        opera[i][j]=save;opera[i][11]=j;j++;}
2011   4                      if(i==0)                                // ÏÔÊ¾
2012   4                        dis_cdata(0x90);
2013   4                      else
2014   4                        dis_cdata(0x88);
2015   4                }
2016   3            else if(save==10&&j<10)   
2017   3            {
2018   4                  if(opera[i][10]==0)         // Ð¡Êýµã¿ÕÊ±±£´æ
2019   4                  {
2020   5                        if(opera[i][11]==0) {opera[i][10]=2;j++;}
2021   5                    else  opera[i][10]=j;
2022   5                  }
2023   4                }
2024   3                else if(save==16)     
2025   3                {                           // É¾³ýÊý¾Ý
2026   4              removal_data(i,0);j=1;
2027   4                      if(i!=0){i--;j=10;}
2028   4            }
2029   3                else if(i==1&&opera[1][11]!=0&&save>11&&save<16)
2030   3            { save1=save;break; }             // Á¬Ðø¼ÆËãÊ±±£´æÔËËã·û
2031   3            else if(save==11&&opera[1][11]==0) continue;// ²Ù×÷Êý1Îª0Ê±²»Àí»á
2032   3                else if(save==11&&opera[1][11]!=0)  break; 
2033   3                else if((i==0||i==1&&j==1)&&save>11&&save<16){i=0; break;}    
2034   3             // µ±²Ù×÷Êý0ÓÉÔËËã·û½áÊøÊäÈë,ÔÙ°´·ûºÅ¼ü¸ü¸Ä
2035   3                else continue;
2036   3          }
2037   2          if(opera[i][10]>opera[i][11]||opera[i][10]==0)
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 34  

2038   2            opera[i][10]=opera[i][11]+1;      // ÕûÊýÊ±Ð¡ÊýÎ»±£´æµ½×îºó
2039   2          while(opera[i][11]>=opera[i][10]&&opera[i][opera[i][11]]==0)
2040   2            opera[i][11]--;                           // È¥³ýÐ¡Êýµãºó¶àÓàµÄ0
2041   2          if(i==0)
2042   2          {
2043   3            opera[1][0]=save;                 // ±£´æÔËËã·û²¢ÏÔÊ¾
2044   3            display_cnasc(0x88,1,tool_cal[save-12]);
2045   3          }
2046   2          if(opera[0][11]==0) display_cnasc(0x95,1," 0");
2047   2          j=1;
2048   2          while(j<=opera[i][11]&&opera[i][j]==0) j++;//ÅÐ¶ÏÊÇ·ñ²Ù×÷ÊýÊÇ·ñÈ«Îª0
2049   2          j--;
2050   2          if(j==opera[i][11]) opera[i][11]=0;
2051   2          j=1;
2052   2        }
2053   1        return 1;
2054   1      }
2055          
2056          
2057          /****************************************************************************************
2058          ¹¦ÄÜ:  ³Ë·¨ÔËËã
2059          ÃèÊö:  ½á¹ûÓÉÓÒµ½×ó±£´æ
2060          ²ÎÊý:  i , j , opera[i][j],p,q,r,k,save1
2061          ·µ»ØÖµ£º1(³É¹¦),0(½á¹ûÎ»0),-1(Òç³ö)
2062          /****************************************************************************************/
2063          
2064          char multiplication()
2065          {
2066   1        uchar p,q,r,k,save1=0; // pÖ¸Ïò²Ù×÷Êý0 ,qÖ¸Ïò²Ù×÷Êý1,rÖ¸Ïò½á¹û
2067   1        if(opera[0][11]==0||opera[1][11]==0) return 0;
2068   1        resu[10]=opera[0][11]+opera[1][11]-opera[0][10]-opera[1][10]+2; // RESU¼ÇÂ¼Ð¡ÊýµãºóµÄÎ»Êý
2069   1        q=opera[1][11];                                       // ¼ÇÂ¼²Ù1µÄÎ»Êý
2070   1        r=9;
2071   1        opera[1][11]=1;
2072   1        k=1;
2073   1        while(opera[1][k]==0) {opera[1][11]=opera[1][11]+1;k++;}      // È¥³ýÇ°¶ËµÄ0
2074   1        k=1;
2075   1        while(opera[0][k]==0) k++;                    // È¥³ýÇ°¶ËµÄ0
2076   1        resu[11]=9;
2077   1        for(resu[0]=9;q>=opera[1][11];q--,resu[0]--)
2078   1        {
2079   2          if(opera[1][q]==0) continue;                // ²Ù1´ËÎ»ÊýÎª0Ê±Ö±½Ó±È½Ï
2080   2          for(p=opera[0][11],r=resu[0];p>=k;p--)
2081   2          {
2082   3            save1=opera[0][p]*opera[1][q];            // ½«Ïà³ËºóµÄÊý±£´æ
2083   3            resu[r]+=(save1%10);//½«»º´æÖÐµÄÊýÈ¡Óàºó¼Óµ½½á¹ûÖÐRÖ¸ÏòµÄÎ»
2084   3            save1/=10;
2085   3            save1=save1+(resu[r]/10);                 // ±£´æ½øÎ»µÄÊý
2086   3            resu[r]%=10;                                      // ÖØÐÂÐ´Èë
2087   3                if(r==1)      //½á¹ûÓÐÒç³öÊ±ÒÆÎ»
2088   3                {
2089   4                  if(save1==0&&p==k) break;   // ¼ÆËãµ½×îºóÎ»ÇÒÃ»½øÎ»Ìø³ö
2090   4                  else if(resu[10]>0)         // ÒªÇóÓÐÐ¡Êý´æÔÚ
2091   4              { 
2092   5                    for(r=9;r>1;r--) resu[r]=resu[r-1]; 
2093   5                    r=1;
2094   5                resu[r]=save1;
2095   5                    resu[11]=1;
2096   5                    resu[10]--;
2097   5                    resu[0]++;
2098   5              }   
2099   4                  else   return -1;                   // ·ñÔòÒç³ö
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 35  

2100   4                }
2101   3                if(r>1&&(r-1)<resu[11])                       // ±£´æ½á¹ûÎ»µÄ×î¸ßÎ»
2102   3                {
2103   4                  if(save1!=0) resu[11]=r-1;
2104   4                  else resu[11]=r;
2105   4                }
2106   3                if(r>1){ r--;resu[r]+=save1;}// µ±RÎª1Ê±Ö»ÐèÒªÒÆÎ»¼ÇÂ¼½á¹û
2107   3          }
2108   2        }
2109   1        while(resu[resu[11]]==0) resu[11]++;  // È¥³ýÇ°¶ËµÄ0
2110   1        resu[0]=opera[0][0];                          // ±£´æ·ûºÅÎ»
2111   1        removal_data(0,1);                                    // ÇåÊý¾Ý²»ÇåÏÔÊ¾
2112   1        if(resu[10]>8)   //Èç¹ûÐ¡ÊýµãºóµÄÊýÓÐ9 Î»»òÒÔÉÏÊ±£¬ÐèºóÒÆµ½Ê¹Ð¡Êýµã·Åµ½2µÄÎ»ÖÃ  
2113   1        {
2114   2          save1=resu[10]-10+resu[11];                 // ¼ÇÂ¼ºóÒÆÎ»Êý
2115   2          if(save1>7)  return 0;       //µ±ºóÒÆµÄÊý´óÓÚÓÐÐ§Êý×ÖµÄÎ»ÊýÊ±½á¹ûÎª0 
2116   2          else        // ·ñÔò°´ÐèÒÆÎ»
2117   2          {
2118   3            for(p=save1+2,r=resu[11];p<10;p++,r++) opera[0][p]=resu[r];
2119   3                opera[0][10]=2;opera[0][11]=9;opera[0][0]=resu[0];
2120   3          }           // ÒòÓÐÐ§ÊýÐ¡ÓÚÐ¡ÊýµãºóµÄÊý,ËùÒÔÊ×Î»Îª0  
2121   2        }     
2122   1        else          //Èç¹ûÐ¡ÊýµãºóµÄÊýÔÚ8Î»ÒÔÄÚÊ±·ÖÁ½ÖÖÇé¿ö
2123   1        {     
2124   2          opera[0][0]=resu[0];  
2125   2          save1=10-resu[11];  // ¼ÇÂ¼ÓÐÐ§Î»Êý
2126   2          if(resu[10]>=save1)         // Ð¡ÊýµÄÔÚÓÐÐ§Êý×ÖµÄ×ó±ß
2127   2          {   
2128   3                for(p=resu[10]+1,r=9;r>=resu[11];p--,r--)
2129   3              opera[0][p]=resu[r];    // ´ÓÐ¡ÊýµãµÄ×îºóÒ»Î»¿ªÊ¼
2130   3            opera[0][10]=2;opera[0][11]=resu[10]+1;
2131   3          }
2132   2          else                                // Ð¡ÊýµãÔÚÓÐÐ§Êý×ÖÄÚ
2133   2          {  
2134   3                for(p=1,r=resu[11];r<10;p++,r++) opera[0][p]=resu[r];
2135   3                  opera[0][11]=10-resu[11];
2136   3                if(resu[10]==0) opera[0][10]=opera[0][11]+1;
2137   3                else opera[0][10]=opera[0][11]-resu[10]+1;
2138   3          }
2139   2        }
2140   1        while(opera[0][11]>=opera[0][10]&&opera[0][opera[0][11]]==0) 
2141   1          opera[0][11]--;     // È¥³ýÐ¡Êýµãºó¶àÓàµÄ0
2142   1        return 1;
2143   1      }
2144          
2145          
2146          /****************************************************************************************
2147          ¹¦ÄÜ:  ³ý·¨ÔËËã
2148          ÃèÊö:  ½á¹ûÓÉ×óµ½ÓÒ±£´æ
2149          ²ÎÊý:  i , j , opera[i][j]
2150          p,q,r, remainde, divisor, decimal
2151          ·µ»ØÖµ£º1(³É¹¦),0(½á¹ûÎ»0),-1(Òç³ö)
2152          *****************************************************************************************/
2153          
2154          char divider()
2155          {
2156   1        unsigned long int divisor=0,remainder=0;
2157   1        uchar p,q,r;
2158   1        char decimal=0;
2159   1        if(opera[1][11]==0) return -1;
2160   1        if(opera[0][11]==0) return 0;
2161   1        for(r=1;r<12;r++)             // ÅÐ¶ÏÁ½ÊýÊÇ·ñÏàµÈ
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 36  

2162   1        {
2163   2          if(opera[0][r]!=opera[1][r]) break;
2164   2        }
2165   1        if(r==12)
2166   1        { 
2167   2          p=opera[0][0];
2168   2          removal_data(0,1);
2169   2          opera[0][0]=r;
2170   2          opera[0][1]=1;
2171   2          opera[0][10]=2;
2172   2          opera[0][11]=1;
2173   2          return 1;
2174   2        }  
2175   1        decimal=(opera[0][11]-opera[0][10])-(opera[1][11]-opera[1][10]);
2176   1        // ¼ÇÂ¼Á½²Ù×÷ÊýÐ¡ÊýµãºóÎ»ÊýµÄ²î 
2177   1        if(decimal>0)         // Èô²Ù0´óÓÚ²Ù1Ê±ÖØÐÂ¼ÇÂ¼Ð¡ÊýµãµÄÎ»ÖÃ
2178   1        {
2179   2          opera[0][10]=opera[0][11]-decimal+1;
2180   2          resu[10]=opera[0][10];
2181   2        }
2182   1        else          // ·ñÔòÐ¡ÊýµãºóÃ»ÓÐÊý£¬¼ÇÂ¼ÓÐÐ§ÊýµÄÎ»Êý
2183   1        {     
2184   2          opera[0][11]-=decimal;
2185   2          opera[0][10]=opera[0][11]+1;
2186   2          resu[10]=opera[0][10];
2187   2        }
2188   1        q=1;
2189   1        divisor=0;
2190   1        while(q<=opera[1][11]) // ½«²Ù1µÄÊýÕûÐÎ»¯
2191   1        {
2192   2          divisor=divisor*10+opera[1][q];q++;
2193   2        }
2194   1        if(divisor==1)   
2195   1        {
2196   2          if(resu[10]>10)     return -1;
2197   2              else return 1;
2198   2        }
2199   1        r=1;p=1;
2200   1        remainder=(unsigned long int)opera[0][1]; // ÏÈ¶ÔÓàÊý¼Ä´æÆ÷¸½³õÖµ
2201   1        do
2202   1        {   
2203   2              if(r>9)  // ½á¹ûÎ»ÒÑ¾­µ½´ï×îºó1Î»
2204   2              {  
2205   3                if(resu[1]==0&&resu[10]!=2) // ÅÐ¶ÏÊÇ·ñÓÐµÃÒÆÎ»
2206   3                {     
2207   4                  for(r=1;r<9;r++) resu[r]=resu[r+1]; 
2208   4                  resu[9]=0;
2209   4                  if(resu[10]!=0) resu[10]--;
2210   4                  r=9;
2211   4                }
2212   3            else if(p>=opera[0][11]||p>=opera[0][10])  break; // Èç¹û¼ÆËãµ½×îºóÒ»Î»£¬»òÕßÓÐÐ¡Êýµã´æÔÚÊ±½áÊø
2213   3            else return -1; // ·ñÔò´íÎó
2214   3              }
2215   2              resu[r]=(uchar)(remainder/divisor);     // ±£´æ½á¹û
2216   2          remainder=(remainder%divisor);              // ÖØÐÂÐ´ÈëÓàÊý
2217   2              p++;r++;         
2218   2          if(p>opera[0][11]&&remainder==0) break; // ³ý¾¡ºóÌø³ö
2219   2          else if(p<=opera[0][11]&&p<10)              // ÓàÊý*10ºó¼ÓºóÒ»Î»
2220   2            {remainder=remainder*10+opera[0][p];}
2221   2          else   remainder=remainder*10;       //³¬³öºóÓàÊý*10
2222   2        }while(1);
2223   1        resu[11]=r-1;
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 37  

2224   1        resu[0]=opera[0][0];
2225   1        removal_data(0,1);
2226   1        r=1;   
2227   1        while(resu[r]==0&&resu[10]!=(r+1)&&r<resu[11]) r++; 
2228   1      //È¥³ý½á¹ûÇ°¶ËµÄ0
2229   1        if(r==resu[11]) return 0;
2230   1        resu[10]=resu[10]-r+1;
2231   1        p=1;
2232   1        while(r<=resu[11]){opera[0][p]=resu[r];r++;p++;}
2233   1        opera[0][0]=resu[0];opera[0][10]=resu[10];opera[0][11]=p-1;
2234   1        while(opera[0][11]>=opera[0][10]&&opera[0][opera[0][11]]==0) 
2235   1          opera[0][11]--;
2236   1        return 1;
2237   1      }
2238          
2239          
2240          /****************************************************************************************
2241          ¹¦ÄÜ:  ¼Ó·¨ÔËËã
2242          ÃèÊö:  ÒÔÐ¡ÊýµãÎ»ÖÐÐÄÁ½±ßÏà¼Ó
2243          ²ÎÊý:  i , j , opera[i][j],p,q,r
2244          ·µ»ØÖµ£º1(³É¹¦),0(½á¹ûÎ»0),-1(Òç³ö)
2245          /****************************************************************************************/
2246          
2247          char adder()
2248          {
2249   1        uchar p,q,r;
2250   1        if(opera[0][11]==0&&opera[1][11]==0)   return 0;
2251   1        else if(opera[0][11]==0)
2252   1          {for(q=0;q<12;q++) opera[0][q]=opera[1][q];return 1;}
2253   1        else if(opera[1][11]==0) return 1; 
2254   1        else
2255   1        {
2256   2          p=opera[0][10]-1;
2257   2          q=opera[1][10]-1;
2258   2          p>q?(r=p):(r=q);
2259   2          resu[10]=r+1;               // Ð¡ÊýµãÎ»±£´æ
2260   2          resu[0]=opera[0][0];        // ±£´æ·ûºÅÎ»
2261   2          while(r>0)                  // ½«Ð¡ÊýµãÇ°µÄÊýÏàÓ¦Ïà¼Óºó·Åµ½½á¹ûÖÐ
2262   2          {
2263   3            if(p>0&&q>0){resu[r]=opera[0][p]+opera[1][q];p--;q--;}
2264   3            else if(p>0&&q==0){resu[r]=opera[0][p];p--;}
2265   3            else      {resu[r]=opera[1][q];q--;}
2266   3            r--;
2267   3          }
2268   2          r=resu[10];
2269   2          p=opera[0][10];
2270   2          q=opera[1][10];
2271   2          while(r<10)                 // ½«Ð¡ÊýµãºóµÄÊý·Åµ½½á¹ûÖÐ
2272   2          {
2273   3            if(p>opera[0][11]&&q>opera[1][11]) break;
2274   3            else if(p<=opera[0][11]&&q<=opera[1][11])
2275   3              {resu[r]=opera[0][p]+opera[1][q];p++;q++;}
2276   3            else if(p<=opera[0][11]&&q>opera[1][11])
2277   3              {resu[r]=opera[0][p];p++;}
2278   3            else      {resu[r]=opera[1][q];q++;}
2279   3            r++;
2280   3          }
2281   2          r--;
2282   2          resu[11]=r;
2283   2          p=0;
2284   2          while(r>0)                  // ÓÉÓÒµ½×ó½«´óÓÚ9µÄÊý½øÎ»
2285   2          {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 38  

2286   3            resu[r]+=p;                       // pÎª½øÎ»±ê¼Ç
2287   3            p=0;
2288   3            if(resu[r]>9) {resu[r]-=10;p=1;}
2289   3            r--;
2290   3          }
2291   2          if(p==1)                            // Òç³öÒÆÎ»
2292   2          {
2293   3            if(resu[10]==10) return -1;
2294   3            else {
2295   4              for(r=9;r>1;r--) resu[r]=resu[r-1];
2296   4              resu[1]=1;resu[10]++;}
2297   3          }
2298   2         removal_data(0,1);
2299   2         r=0; 
2300   2         while(r<12){opera[0][r]=resu[r];r++;}
2301   2         while(opera[0][11]>=opera[0][10]&&opera[0][opera[0][11]]==0)
2302   2           opera[0][11]--;
2303   2         return 1;
2304   2        }
2305   1      }
2306          
2307          /****************************************************************************************
2308           ¹¦ÄÜ:  ¼õ·¨ÔËËã
2309           ÃèÊö:  ÏÈ±È½ÏÁ½²Ù×÷ÊýµÄ´óÐ¡ÓÃone ,two»¥»»
2310          ²ÎÊý:  i , j , opera[i][j],p,q,r£¬one£¬two
2311          ·µ»ØÖµ£º1(³É¹¦),0(½á¹ûÎ»0),-1(Òç³ö)
2312          /****************************************************************************************/
2313          
2314          char subtraction()
2315          {
2316   1        uchar p,q,r,one,two;
2317   1        if(opera[0][11]==0&&opera[1][11]==0)   return 0;
2318   1        else if(opera[0][11]==0)
2319   1        {
2320   2          for(q=1;q<12;q++) 
2321   2          opera[0][q]=opera[1][q];
2322   2              opera[0][0]=!opera[0][0];return 1;
2323   2        }
2324   1        else if(opera[1][11]==0) return 1; 
2325   1        else
2326   1        { // ±È½Ï´óÐ¡(´ó·Åµ½one)
2327   2          if(opera[0][10]>opera[1][10]){one=0;two=1;}
2328   2          else if(opera[1][10]>opera[0][10]) {one=1;two=0;}
2329   2          else
2330   2          {
2331   3            r=1;
2332   3                while(r<10&&opera[0][r]==opera[1][r]) r++;
2333   3                if(r==10) {removal_data(0,1);return 0;}
2334   3            opera[0][r]>opera[1][r]?(one=0,two=1):(one=1,two=0);
2335   3          }
2336   2          p=opera[one][10]-1;
2337   2          q=opera[two][10]-1;
2338   2          r=p;                        // ±£´æÐ¡ÊýµãÇ°µÄÊý
2339   2          resu[10]=r+1;       // ±£´æÐ¡ÊýµãÎ»
2340   2          resu[0]=0;          // ÓÃ×÷½èÎ»±ê¼Ç
2341   2          while(r>0)          // Ð¡ÊýµãÇ°Ïà¼õ
2342   2          {
2343   3            if(p>0&&q>0)
2344   3                {
2345   4                  opera[two][q]+=resu[0];
2346   4              resu[0]=0;
2347   4              if(opera[one][p]>=opera[two][q])
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 39  

2348   4                resu[r]=opera[one][p]-opera[two][q];
2349   4                  else
2350   4                  {
2351   5                        resu[0]=1;
2352   5                        resu[r]=10+opera[one][p]-opera[two][q];
2353   5                  }
2354   4                  p--;q--;
2355   4                }
2356   3                else 
2357   3                {         
2358   4              if(opera[one][p]<resu[0])
2359   4                {resu[r]=10+opera[one][p]-resu[0];}
2360   4                  else
2361   4                        {resu[r]=opera[one][p]-resu[0];resu[0]=0;p--;}
2362   4                }
2363   3            r--;
2364   3          }
2365   2          r=resu[10];
2366   2          p=opera[one][10];
2367   2          q=opera[two][10];
2368   2          while(r<10)         // ½«Ð¡ÊýµãºóµÄÊý·Åµ½½á¹ûÖÐ
2369   2          {
2370   3            if(p>opera[one][11]&&q>opera[two][11]) break;
2371   3            else if(p<=opera[one][11]&&q<=opera[two][11])
2372   3                {
2373   4              if(opera[one][p]>=opera[two][q])  resu[r]=opera[one][p]-opera[two][q];
2374   4                  else
2375   4                  {
2376   5                    resu[r]=10+opera[one][p]-opera[two][q];
2377   5                    resu[0]=r;
2378   5                    for(r-=1;r>0;r--) // ÏòÇ°½èÎ»
2379   5                        {
2380   6                      if(resu[r]==0) resu[r]=9;
2381   6                          else{resu[r]-=1;break;}
2382   6                        }
2383   5                        r=resu[0];    
2384   5                  }
2385   4                  p++;q++;
2386   4                }                                         
2387   3            else if(p<=opera[one][11]&&q>opera[two][11])
2388   3              {resu[r]=opera[one][p];p++;}
2389   3            else      
2390   3                {
2391   4                  resu[r]=10-opera[two][q];  
2392   4                  resu[0]=r;
2393   4                  for(r-=1;r>0;r--)
2394   4              {
2395   5                        if(resu[r]==0) resu[r]=9;
2396   5                    else{ resu[r]-=1;break;}
2397   5                      }
2398   4                  r=resu[0];
2399   4                  q++;        
2400   4                }
2401   3            if(r==9)          // ½á¹ûÒç³öÒÆÎ»
2402   3                {
2403   4                  if(resu[1]==0&&resu[10]!=2) 
2404   4              {
2405   5                for(r=1;r<9;r++) resu[r]=resu[r+1];
2406   5                        resu[10]--;resu[9]=0;r=8;
2407   5              }
2408   4                }
2409   3            r++;
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 40  

2410   3          }
2411   2          r--;
2412   2          resu[11]=r;
2413   2          if(one==0)resu[0]=opera[0][0];      // ·ûºÅÎ»Ð´Èë
2414   2          else resu[0]=!opera[0][0];
2415   2          removal_data(0,1);
2416   2          r=1;
2417   2          while(resu[r]==0&&resu[10]!=(r+1)) r++; // È¥³ýÇ°¶Ë0
2418   2          resu[10]=resu[10]-r+1;                      // ÖØÐÂÐ´ÈëÐ¡Êýµã
2419   2          p=1;
2420   2          while(r<=resu[11]){opera[0][p]=resu[r];r++;p++;}
2421   2          opera[0][0]=resu[0];opera[0][10]=resu[10];opera[0][11]=p-1;
2422   2          while(opera[0][11]>=opera[0][10]&&opera[0][opera[0][11]]==0) opera[0][11]--;
2423   2          return 1;
2424   2        }
2425   1      }
2426          
2427          
2428          /****************************************************************************************
2429          ¹¦ÄÜ:  ¼ÆËãÆ÷Ö÷º¯Êý
2430          ÃèÊö:  ¸ù¾Ý·ûºÅÎ»,ÔËËã·ûµ÷ÓÃº¯Êý
2431          ²ÎÊý:  state,save
2432          ·µ»ØÖµ£ºÎÞ
2433          ****************************************************************************************/
2434          
2435          
2436          void calculator(void)
2437          {
2438   1        char data state;
2439   1        uchar data save;
2440   1        save1=0;
2441   1        dis_title_e();
2442   1        display_cnasc(0x82,3,tool_menu[0]); 
2443   1        display_cnasc(0x96,2,"µÈÓÚ");
2444   1        display_cnasc(0x8e,2,"É¾³ý");
2445   1        display_cnasc(0x9e,2,"ÍË³ö");
2446   1        removal_data(2,0);    // 0ÎªÇå³ýÏÔÊ¾
2447   1        removal_data(0,0);
2448   1        i=0;j=1;
2449   1        while(1)
2450   1        {     
2451   2          cal_run=0;
2452   2          state=input_data();
2453   2          if(state==1)  // ¸ù¾Ýopera[1][0]µÄÊýÖµµ÷ÓÃ³ÌÐò
2454   2          {
2455   3            if(opera[1][0]==12&&opera[0][0]==0||opera[1][0]==13&&opera[0][0]==1) 
2456   3                  state=adder();
2457   3            else if(opera[1][0]==12&&opera[0][0]==1||opera[1][0]==13&&opera[0][0]==0)
2458   3                  state=subtraction();
2459   3            else if(opera[1][0]==14) state=multiplication();
2460   3            else state=divider();
2461   3          }
2462   2              if(state==0)  return;
2463   2          i=0;j=1;
2464   2          cal_run=1;
2465   2          switch(state)
2466   2          {
2467   3            case -1:                                          // ½á¹ûÒç³ö
2468   3                        removal_data(2,0);
2469   3                    removal_data(0,0);  
2470   3                            display_cnasc(0x8a,3,"Òç³ö!!");
2471   3                            save1=0;
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 41  

2472   3                                break;
2473   3            case  0:                                  // ½á¹ûÎªÁã
2474   3                                if(save1==0)
2475   3                                { 
2476   4                                  removal_data(2,1);
2477   4                                      removal_data(0,1);
2478   4                                  display_cnasc(0x98,1,"= ");
2479   4                                  display_cnasc(0x9d,1," 0");
2480   4                                }
2481   3                                break;                                // ½á¹ûÏÔÊ¾
2482   3            case  1: 
2483   3                                if(save1==0) 
2484   3                                { 
2485   4                                  cal_run=1;
2486   4                                  display_cnasc(0x98,1,"= ");
2487   4                      dis_cdata(0x98);
2488   4                                }
2489   3                                break;
2490   3          }
2491   2              if(save1==0) save=gotkey();      // save1¼ÇÂ¼Á¬Ðø¼ÆËã·û
2492   2              cal_run=0;      
2493   2              if((save>11&&save<16&&state==1)||save1!=0) 
2494   2              {
2495   3                removal_data(2,0);
2496   3                removal_data(1,0);
2497   3                display_cnasc(0x90,6,"               ");
2498   3                if(opera[0][11]==0) display_cnasc(0x95,1," 0");
2499   3                else dis_cdata(0x90);
2500   3                if(save1!=0)save=save1;
2501   3                save1=0;
2502   3                display_cnasc(0x88,1,tool_cal[save-12]);
2503   3                opera[1][0]=save;
2504   3                i=1;j=1;
2505   3              }
2506   2              else if(save>=0&&save<10&&state==1)
2507   2              {
2508   3                removal_data(2,0);
2509   3                removal_data(0,0);
2510   3                opera[0][1]=save;
2511   3                opera[0][11]++;
2512   3                dis_cdata(0x90);
2513   3                i=0;j=2;
2514   3              }
2515   2              else if(save==10)
2516   2              {  
2517   3                removal_data(2,0);
2518   3                removal_data(0,0);
2519   3            opera[i][10]=2;
2520   3                opera[i][11]=1;
2521   3            j=2;
2522   3              }
2523   2              else 
2524   2              { 
2525   3                removal_data(2,0);
2526   3                removal_data(0,0);
2527   3              }
2528   2        }                                                                                     
2529   1      }
2530            
2531          
2532          /*=====================================================================================
2533           º¯ÊýÃû³Æ£ºÎÂ¶È¹¦ÄÜ
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 42  

2534           ¹¦ÄÜÃèÊö£ºÁ¬Ðø¼ì²éÎÂ¶È
2535           È«¾Ö±äÁ¿£ºtemprun  oth_run  als_temp  adju_si 
2536           ²ÎÊýËµÃ÷£º¼ûº¯Êý
2537           ·µ»ØËµÃ÷£ºÎÞ
2538           Éè ¼Æ ÈË£ºLIJH
2539           °æ    ±¾£º1.0
2540           Ëµ    Ã÷£º
2541           ======================================================================================*/
2542          
2543          
2544          /*ÎÂ¶ÈÏÔÊ¾*/
2545          uchar temp_func_dis(void)
2546          {
2547   1        uchar save[2],k;
2548   1        clear_dis();
2549   1        dis_title_e();
2550   1        display_cnasc(0x82,3,"ÎÂ¶È¼Æ");  
2551   1        display_cnasc(0x98,3,"Éè¶¨");
2552   1        display_cnasc(0x9e,3,"ÍË³ö");
2553   1        display_cnasc(0x8e,1," \x1f");
2554   1        num2_asc_dis(10,0x85);
2555   1        temprun=1;
2556   1        while(1)
2557   1        {
2558   2              if(ds18b20)
2559   2          {
2560   3            if(temp.t_data[0]>99)       // ÎÂ¶ÈÖµ´óÓÚ99Ê±
2561   3                {
2562   4                  save[0]=temp.t_data[0]/100;
2563   4              save[1]=(temp.t_data[0]/10)%10;
2564   4              num2_asc_dis(save[0],0x80);
2565   4                  num2_asc_dis(save[1],0x81);
2566   4                  save[0]=char_num[temp.t_data[0]%10];
2567   4                  num2_asc_dis(save[0],0x82);
2568   4            }
2569   3                else                                   // ÎÂ¶ÈÐ¡ÓÚ100 
2570   3                {
2571   4              con_disp(0x00,0x00,0x80,0x90,1,16);
2572   4                      con_disp(0x00,0x00,0x88,0x90,1,16);
2573   4                      if(temp_pn) con_disp(0x3f,0xfc,0x80,0x9d,1,3);
2574   4                  else  con_disp(0x00,0x00,0x80,0x9d,1,3);
2575   4                  save[0]=temp.t_data[0]/10;
2576   4                  save[1]=temp.t_data[0]%10;
2577   4                  num2_asc_dis(save[0],0x81);
2578   4                  num2_asc_dis(save[1],0x82);
2579   4                }
2580   3                save[0]='.';
2581   3                save[1]=char_num[temp.t_data[1]/10];
2582   3                display_cnasc(0x8b,1,save);
2583   3                save[0]=char_num[temp.t_data[1]%10];
2584   3                if(save[0]=='1') save[1]='2';            // ²¹³¥¾«¶È
2585   3                else if(save[0]=='7') save[1]='5';
2586   3                else if(save[0]=='8'||save[0]=='1') save[1]='7';
2587   3                else save[1]='0';
2588   3                display_cnasc(0x8c,1,save);
2589   3          }
2590   2              else 
2591   2              {
2592   3            clear_dis();
2593   3            display_cnasc(0x92,4,"Ã»ÓÐ·¢ÏÖ");
2594   3            display_cnasc(0x8c,4,"ÎÂ¸ÐÆ÷£¡");
2595   3                delay_pw();
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 43  

2596   3                temprun=0;
2597   3                return 0;
2598   3              }
2599   2              k=gotkey();
2600   2              if(k==2)         // ½øÈëÉèÖÃ²Ëµ¥
2601   2              {
2602   3                display_cnasc(0x8e,1," \x04");
2603   3                delay(35000);
2604   3                display_cnasc(0x8e,1," \x1e");
2605   3                display_cnasc(0x9a,4,"\x11 (ok) \x10");
2606   3                return 1;
2607   3              }
2608   2        }
2609   1      }
2610          
2611          /*¾¯±¨ÎÂ¶ÈÉèÖÃ*/
2612          uchar temp_func_set(void)
2613          {
2614   1        uchar save[2];
2615   1        temprun=0;
2616   1        oth_run=0;
2617   1        rds1302_data();
2618   1        while(1)
2619   1        {  
2620   2              if(oth_run)
2621   2              {
2622   3                con_disp (0x00,0x00,0x88,0x90,2,16);
2623   3                con_disp (0xff,0xff,0x8e,0x90,2,16);
2624   3              }
2625   2              else
2626   2              {
2627   3                con_disp (0xff,0xff,0x88,0x90,2,16);
2628   3                con_disp (0x00,0x00,0x8e,0x90,2,16);
2629   3              }       
2630   2              save[0]=gotkey();
2631   2              if(save[0]==1||save[0]==3) oth_run=!oth_run; 
2632   2              if(save[0]==5) return 1;
2633   2              if(save[0]==11) 
2634   2              {  
2635   3                if(oth_run) return 0;
2636   3                else  
2637   3                { 
2638   4                      clear_dis();
2639   4                      dis_title_e();
2640   4                      save[1]=save[0]=0;
2641   4                      oth_run=0;
2642   4                  dis_title_e();
2643   4              display_cnasc(0x82,3,"Éè  ¶¨"); 
2644   4                  display_cnasc(0x90,5,"¾¯±¨ÎÂ¶È£º");
2645   4                      display_cnasc(0x88,7,"¸ßÓÚ¡¾    ¡¿¡æ"); 
2646   4                      display_cnasc(0x98,8,"µÍÓÚ¡¾    ¡¿¡æ \x10"); 
2647   4                      while(1)
2648   4                      {
2649   5                        if(save[1]==2) con_disp(0x00,0x00,index_temp_set[save[1]].lnum,index_temp_set[save[1]].rnum,2,13);
2650   5                        else con_disp(0x00,0x00,index_temp_set[save[1]].lnum,index_temp_set[save[1]].rnum,2,13);
2651   5                        if(save[0]==2) con_disp(0x0f,0xff,index_temp_set[save[0]].lnum,index_temp_set[save[0]].rnum,1,13);
2652   5                else con_disp(0xff,0xff,index_temp_set[save[0]].lnum,index_temp_set[save[0]].rnum,2,13);
2653   5                    save[1]=save[0];
2654   5                adju_si=0;
2655   5                        oth_run=0;
2656   5                        while(1)
2657   5                        {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 44  

2658   6                          for(i=0;i<2;i++)
2659   6                          {
2660   7                            j=0x8b+i*16;
2661   7                                if(als_temp[i]==255) display_cnasc(j,2," off"); // 255ÖµÎª¹Ø±ÕÖµ
2662   7                            else 
2663   7                                {
2664   8                                  save1=save[1];
2665   8                                  if(als_temp[i]>127)  // µ±ÊýÖµ´óÓÚ127Ê±ÎÂ¶ÈÖµÎª¸ºÊý
2666   8                                  { 
2667   9                                        display_cnasc(j,1,"- ");
2668   9                                        save[0]=char_num[(als_temp[i]-128)/10];
2669   9                                        save[1]=char_num[(als_temp[i]-128)%10];
2670   9                                        display_cnasc(j+1,1,save);
2671   9                                  }
2672   8                                  else
2673   8                                  {
2674   9                                        save[0]=' ';
2675   9                                        save[1]=char_num[als_temp[i]/100];
2676   9                                        if(save[1]=='0') save[1]=' ';
2677   9                                        display_cnasc(j,1,save);
2678   9                                        save[0]=char_num[als_temp[i]/10%10];
2679   9                                        save[1]=char_num[als_temp[i]%10];
2680   9                                        display_cnasc(j+1,1,save);
2681   9                                  }
2682   8                                  save[1]=save1;
2683   8                                }
2684   7                          }           
2685   6                              save[0]=gotkey();
2686   6                              do                 // ÊäÈë·ûºÅµÈ´ýÊýÖµÊäÈë»òÏÂÒ»Î»
2687   6                              {
2688   7                                if(save[0]==13){ oth_run=1;display_cnasc(0x8b+save[1]*16,2,"-   ");}
2689   7                                else if(save[0]==12){ oth_run=0;display_cnasc(0x8b+save[1]*16,2,"    ");}
2690   7                                else break;
2691   7                                save[0]=gotkey();
2692   7                                if(save[0]>=0&&save[0]<10||save[0]==11) break;
2693   7                              }while(1);
2694   6                              if(save[0]==14){ als_temp[save[1]]=255;}  // ³ËºÅÖ±½Ó½«¾¯±¨ÎÂ¶È¹Ø±Õ
2695   6                              if(save[0]>=0&&save[0]<10&&save[1]<2)
2696   6                          {
2697   7                                if(adju_si)
2698   7                            { 
2699   8                                  adju_si=0;
2700   8                                  if(oth_run) als_temp[save[1]]&=0x7f;  // ÏûÈ¥·ûºÅÎ»
2701   8                                      if(als_temp[save[1]]>24&&!oth_run) als_temp[save[1]]=240;
2702   8                              else als_temp[save[1]]=als_temp[save[1]]*10+save[0];
2703   8                                      if(oth_run&&als_temp[save[1]]>50) als_temp[save[1]]=50;                 
2704   8                                      if(!oth_run&&als_temp[save[1]]>120) als_temp[save[1]]=120; 
2705   8                                      if(!oth_run&&als_temp[save[1]]<100) adju_si=1;  // ¸ù¾ÝÊýÖµ´ò¿ªÁ¬Ð´
2706   8                                      if(oth_run&&als_temp[save[1]]<10)  adju_si=1;
2707   8                                }
2708   7                                else
2709   7                                { 
2710   8                                  als_temp[save[1]]=save[0];
2711   8                                      adju_si=1;
2712   8                                }
2713   7                                if(oth_run) als_temp[save[1]]=als_temp[save[1]]|0x80;  // Ð´Èë·ûºÅ
2714   7                                else als_temp[save[1]]=als_temp[save[1]]&0x7f;
2715   7                              }                       
2716   6                              if(save[0]==11)
2717   6                              {
2718   7                                if(als_temp[1]!=255&&als_temp[0]!=255)           // ÉÏÏÂÏÞÎÂ¶Èµ÷Õû
2719   7                                {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 45  

2720   8                              if(save[1]==0&&als_temp[0]<als_temp[1]){als_temp[0]=als_temp[1];}
2721   8                                  if(save[1]==1&&als_temp[1]>als_temp[0]){als_temp[1]=als_temp[0];}
2722   8                                }
2723   7                                save[0]=save[1]+1;adju_si=0;break;}
2724   6                      if(save[0]==10&&save[1]!=0) {save[0]=save[1]-1;adju_si=0;break;}
2725   6                        }
2726   5                        oth_run=0;
2727   5                        if(save[0]==3&&save[1]==2) break;
2728   5                      }
2729   4                      save_y_or_n();
2730   4                      if(oth_run)
2731   4                      { 
2732   5                        wds1302_data(d02_temp,als_temp[0]);
2733   5                        wds1302_data(d02_temp+2,als_temp[1]);
2734   5                      }
2735   4                      return 1;
2736   4                }
2737   3              }
2738   2        }
2739   1      }                  
2740                                            
2741                           
2742          /*ÎÂ¶È¼ÆÖ÷º¯Êý*/                 
2743          void temp_func(void)
2744          {                
2745   1        uchar t;      
2746   1        while(1)
2747   1        {
2748   2          oth_run=1;
2749   2              t=temp_func_dis();
2750   2          if(t==1)
2751   2              {
2752   3                t=temp_func_set();
2753   3                if(t==0) return;
2754   3              }
2755   2          else return;
2756   2        }
2757   1      } 
2758          /*=====================================================================================
2759           º¯ÊýÃû³Æ£ºÄÖÁå¹¦ÄÜ
2760           ¹¦ÄÜÃèÊö£ºÉè¶¨ÄÖÁå
2761           È«¾Ö±äÁ¿£ºalarm_time adju_si
2762           ²ÎÊýËµÃ÷£º¼ûº¯Êý
2763           ·µ»ØËµÃ÷£ºÎÞ
2764           Éè ¼Æ ÈË£ºLIJH
2765           °æ    ±¾£º1.0
2766           Ëµ    Ã÷£º
2767           ======================================================================================*/
2768          
2769          
2770          void alarm_func(void)
2771          {
2772   1        uchar save[2],a,d;
2773   1        clear_dis();
2774   1        dis_title_e();
2775   1        display_cnasc(0x82,3,"ÄÖ  ÖÓ");  
2776   1        display_cnasc(0x91,6,"×´Ì¬£º\x11    \x10");
2777   1        display_cnasc(0x89,3,"ÄÖÁå£º"); 
2778   1        display_cnasc(0x9f,1,"¡ú");
2779   1        display_cnasc(0x90,1,"¡º");
2780   1        display_cnasc(0x8f,1,"¡»"); 
2781   1        adju_si=0; 
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 46  

2782   1        a=0;d=0;
2783   1        save[0]=char_num[alarm_time[0]>>4];
2784   1        save[1]=char_num[alarm_time[0]&0x0f];
2785   1        display_cnasc(0x8c,1,save);
2786   1        display_cnasc(0x8d,1,": ");
2787   1        save[0]=char_num[alarm_time[1]>>4];
2788   1        save[1]=char_num[alarm_time[1]&0x0f]; 
2789   1        display_cnasc(0x8e,1,save);
2790   1        do 
2791   1        {
2792   2          if(a==0)
2793   2              {    
2794   3                display_cnasc(0x95,1,alm_sign[alm]);
2795   3            display_cnasc(0x94,1,"\x11 ");
2796   3            display_cnasc(0x96,1," \x10");
2797   3                con_disp(0x00,0x00,index_alm[d-1].lnum,index_alm[d-1].rnum,1,14);
2798   3              }
2799   2          if(a>0&&a<4)
2800   2              {
2801   3                if(d==0)
2802   3                {
2803   4                      display_cnasc(0x94,1,"  ");
2804   4              display_cnasc(0x96,1,"  ");
2805   4                }
2806   3                else 
2807   3                 con_disp(0x00,0x00,index_alm[d-1].lnum,index_alm[d-1].rnum,1,14);
2808   3               con_disp(0xff,0xff,index_alm[a-1].lnum,index_alm[a-1].rnum,1,14);      
2809   3          }             
2810   2              d=a;
2811   2              while(1)
2812   2              {
2813   3                a=gotkey();
2814   3                if((a==1||a==3)&&d==0)
2815   3                { 
2816   4                  alm=!alm;
2817   4                      if(a==1) display_cnasc(0x94,1,"\x09 ");
2818   4                      else display_cnasc(0x96,1," \x09");
2819   4                      delay(35000);
2820   4                      if(a==1) display_cnasc(0x94,1,"\x11 ");
2821   4              else display_cnasc(0x96,1," \x10");
2822   4                      display_cnasc(0x95,1,alm_sign[alm]);
2823   4                }
2824   3                if(d>0&&d<3&&a>=0&&a<10)
2825   3                {
2826   4                  if(adju_si)
2827   4                      {
2828   5                        alarm_time[d-1]<<=4;alarm_time[d-1]+=a;
2829   5                        if(d==1&&alarm_time[0]>0x23) alarm_time[0]=a;
2830   5                        else if(d==2&&alarm_time[1]>0x59) alarm_time[1]=a;
2831   5                        else adju_si=0;
2832   5                      }
2833   4                  else  
2834   4                      {
2835   5                        alarm_time[d-1]=a;adju_si=1;
2836   5                      }
2837   4                      save[0]=char_num[alarm_time[d-1]>>4];
2838   4                  save[1]=char_num[alarm_time[d-1]&0x0f];
2839   4                  display_cnasc(0x8c+(d-1)*2,1,save);
2840   4                }
2841   3                if(a==11){a=d+1;break;}
2842   3                if(a==10&&d!=0){a=d-1;break;}
2843   3              }
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 47  

2844   2              adju_si=0;
2845   2              if(a==4) 
2846   2              { 
2847   3                save_y_or_n();
2848   3                wds1302_data(d02_signs,signs);
2849   3                wds1302_data(d02_alm,alarm_time[0]);
2850   3                wds1302_data(d02_alm+2,alarm_time[1]);
2851   3                return;
2852   3              }
2853   2        }while(1);
2854   1      }
2855          
2856          
2857          
2858          /*=====================================================================================
2859           º¯ÊýÃû³Æ£ºÀºÇòÆ÷¹¦ÄÜ
2860           ¹¦ÄÜÃèÊö£º·ÖÊý  Ê±¼ä  24Ãë  
2861           È«¾Ö±äÁ¿£ºresu  opera
2862           ²ÎÊýËµÃ÷£º¼ûº¯Êý
2863           ·µ»ØËµÃ÷£ºÎÞ
2864           Éè ¼Æ ÈË£ºLIJH
2865           °æ    ±¾£º1.0
2866           Ëµ    Ã÷£º
2867           ======================================================================================*/
2868          
2869          /*±ÈÈüÉèÖÃ*/
2870          void nba_set(void)
2871          {
2872   1        uchar nba,save1,key,save[2];
2873   1        clear_dis();
2874   1        dis_title_e(); 
2875   1        if(resu[7]==1) display_cnasc(0x82,3,"¼Ó  Ê±");
2876   1        else  
2877   1        {
2878   2          display_cnasc(0x82,3,"Éè  ¶¨");
2879   2          opera[0][0]=0;
2880   2          opera[1][0]=1;
2881   2        }
2882   1        resu[6]=0;    // ¸³³õÖµ
2883   1        resu[0]=1;
2884   1        resu[1]=4;
2885   1        resu[2]=12;
2886   1        resu[3]=0;
2887   1        resu[4]=24;
2888   1        display_cnasc(0x90,7,"¶Ó1:ºì  ¶Ó2:°×");
2889   1        display_cnasc(0x88,7,"24Ãë:Y  ½ÚÊý:4");
2890   1        display_cnasc(0x98,8,"Ã¿½ÚÊ±¼ä: 12·ÖÖÓ");
2891   1        save1=0;nba=0;
2892   1        while(1)
2893   1        {
2894   2          if(save1==4) display_cnasc(0x9c,1,":");
2895   2              else display_cnasc(index_nba[save1],1,"  ");
2896   2              if(nba==4)  display_cnasc(0x9c,1,":\x10");
2897   2              else display_cnasc(index_nba[nba],1,"\x11 "); 
2898   2              save1=nba;
2899   2              key=gotkey();   
2900   2              if(key==1||key==3)
2901   2              {         
2902   3                switch(nba)     // µ¼º½¸ü¸ÄÊý¾Ý
2903   3                {
2904   4                  case 0:                         
2905   4                      case 1:
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 48  

2906   4                              if(key==1){if(opera[nba][0]>0) opera[nba][0]--;
2907   5                                                 else opera[nba][0]=7;}
2908   4                                      if(key==3){if(opera[nba][0]<7) opera[nba][0]++;
2909   5                                                 else opera[nba][0]=0;}
2910   4                                      display_cnasc(index_nba[nba]-1,1,nba_oppo[opera[nba][0]]);
2911   4                                      break;
2912   4                      case 2:
2913   4                                      if(resu[0]>0) resu[0]=0;
2914   4                                      else resu[0]=1;
2915   4                                      if(resu[0]>0)   display_cnasc(0x8a,1,":Y");
2916   4                                      else display_cnasc(0x8a,1,":N");
2917   4                                      break;
2918   4                      case 3:
2919   4                                      if(key==1){if(resu[1]>1) resu[1]--;
2920   5                                                  else  resu[1]=4;}
2921   4                                  if(key==3){if(resu[1]<4) resu[1]++;
2922   5                                             else resu[1]=1;}
2923   4                                      save[0]=':';
2924   4                                      save[1]=char_num[resu[1]];
2925   4                              display_cnasc(0x8e,1,save);
2926   4                                      break;
2927   4                      case 4:
2928   4                                      if(key==1){if(resu[2]>0) resu[2]--;
2929   5                                                  else  resu[2]=60;}
2930   4                                  if(key==3){if(resu[2]<60) resu[2]++;
2931   5                                             else resu[2]=0;}
2932   4                                      save[0]=char_num[resu[2]/10];
2933   4                                      save[1]=char_num[resu[2]%10];
2934   4                              display_cnasc(0x9d,1,save);
2935   4                                      resu[5]=resu[2];
2936   4                                      break;
2937   4            }
2938   3              }
2939   2              if(key==11) 
2940   2              {
2941   3                nba++; if(nba==5) return;                        
2942   3              }
2943   2              if(key==10&&nba!=0)  nba--;
2944   2        }
2945   1      }
2946          
2947          
2948          
2949          /*½çÃæÆäËûÔªËØ*/
2950          void nba_oth_dis(void)
2951          {
2952   1        uchar save[2];
2953   1        if(resu[7]==1) display_cnasc(0x80,5,"¼ÓÊ±Ê±¼ä£º");
2954   1        else display_cnasc(0x80,5,"±ÈÈüÊ±¼ä£º");
2955   1        display_cnasc(0x98,1,nba_oppo[opera[0][0]]);
2956   1        display_cnasc(0x9e,1,nba_oppo[opera[1][0]]);
2957   1        display_cnasc(0x99,1,"¶Ó");
2958   1        display_cnasc(0x9f,1,"¶Ó");
2959   1        save[0]='0';
2960   1        save[1]=char_num[resu[6]+1];
2961   1        display_cnasc(0x9b,1,save);
2962   1        display_cnasc(0x9c,1,"st");
2963   1        con_disp(0xff,0xff,0x83,0x90,2,1); // »­Õý·½¿ò
2964   1        con_disp(0xff,0xff,0x8b,0x8f,2,1);
2965   1        con_disp(0x80,0x00,0x83,0x91,1,15);
2966   1        con_disp(0x00,0x01,0x84,0x91,1,15);
2967   1        con_disp(0x80,0x00,0x8b,0x80,1,15);
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 49  

2968   1        con_disp(0x00,0x01,0x8c,0x80,1,15);
2969   1        nba_dis_time();
2970   1        if(resu[0]==0) display_cnasc(0x93,2,"\x07--\x07");
2971   1        display_cnasc(0x8b,2," S! ");
2972   1      }
2973          
2974          
2975          
2976          /*ÀºÇòÆ÷Ö÷º¯Êý*/
2977          void nba_timer(void)
2978          {
2979   1        uchar save,key,nba=0;
2980   1        als=di0=1;alm=keb=di1=oth_run=0;
2981   1        time_init();  
2982   1        display_cnasc(0x82,3,"ÀºÇòÆ÷");
2983   1        dis_title_e(); 
2984   1        removal_data(0,1); 
2985   1        while(1)        // Ê¹ÓÃËµÃ÷
2986   1        {
2987   2              display_cnasc(0x90,8,timer_tips[nba]);
2988   2              display_cnasc(0x88,8,timer_tips[nba+1]);
2989   2              display_cnasc(0x98,8,timer_tips[nba+2]);
2990   2              key=gotkey();
2991   2              if(key==11)
2992   2              {
2993   3                nba+=3;
2994   3                if(nba>9) break;
2995   3              }
2996   2              if(key==10)
2997   2              {
2998   3                if(nba>0) nba-=3 ;
2999   3              }
3000   2        }
3001   1      nn:
3002   1        nba_set();
3003   1        clear_dis();
3004   1        nba_oth_dis();
3005   1        nba_tim=1;
3006   1        while(1)
3007   1        {     
3008   2              for(save=0x80,nba=0;nba<2;nba++)
3009   2              {
3010   3                if(opera[nba][1]>99)  // ·ÖÊýÏÔÊ¾
3011   3                {
3012   4                  num2_asc_dis(opera[nba][1]/100,save);
3013   4                      num2_asc_dis(opera[nba][1]/10%10,save+1);
3014   4                      num2_asc_dis(opera[nba][1]%10,save+2);
3015   4                }
3016   3                else
3017   3                {
3018   4                      num2_asc_dis(opera[nba][1]/10,save);
3019   4                      num2_asc_dis(opera[nba][1]%10,save+1);
3020   4            }
3021   3                if(opera[1][1]>99) save=0x85;
3022   3                else save=0x86;
3023   3              }
3024   2              
3025   2              do
3026   2              {
3027   3              key=gotkey();
3028   3        ss:
3029   3              switch(key)
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 50  

3030   3              {
3031   4                case 12:
3032   4                case 13:
3033   4                         if(key==12)
3034   4                                   {if(opera[0][1]<250) opera[0][1]++;}
3035   4                         else 
3036   4                                   {if(opera[0][1]>0) opera[0][1]--;}
3037   4                                 save=110;
3038   4                                 break;
3039   4                case 14:
3040   4                case 15:
3041   4                         if(key==14)
3042   4                                   {if(opera[1][1]<250) opera[1][1]++;}
3043   4                         else 
3044   4                                   {if(opera[1][1]>0) opera[1][1]--;}
3045   4                                 save=110;
3046   4                                 break;
3047   4                case  7:
3048   4                         TR1=TR0=EA=0;
3049   4                         if((++resu[3])>59)
3050   4                         {
3051   5                           resu[3]=0;
3052   5                               if((++resu[2])>59)
3053   5                                       { 
3054   6                                         resu[3]=0;
3055   6                                         if(++resu[2]>60) resu[2]=0;
3056   6                                       }
3057   5                                 }
3058   4                             if(resu[4]<24) resu[4]++;
3059   4                                 nba_dis_time();
3060   4                                 break;
3061   4                case  8:
3062   4                         if(resu[0]==1)
3063   4                                 { 
3064   5                                   TL1=(time_count&0x00FF);
3065   5                       TH1=(time_count>>8);
3066   5                                   resu[4]=24; nba_dis_time();
3067   5                                       TR0=TR1=EA=1;
3068   5                                 }
3069   4                                 break;
3070   4                case  9: 
3071   4                         if(resu[2]==0&&resu[3]==0)
3072   4                         {
3073   5                           resu[2]=resu[5];resu[4]=24;
3074   5                                       if(resu[6]==resu[1])
3075   5                                       {                                                        // ÅÐ¶Ï±È·Ö½øÐÐ¼ÓÊ±Èü
3076   6                                         if(opera[0][1]==opera[1][1]){nba_tim=0;resu[7]=1; goto nn;}
3077   6                                         while(gotkey()!=10);           // ·ñÔòÖ»ÄÜÍË³ö
3078   6                                         signs=r1302(d02_signs+1); 
3079   6                                         nba_tim=0;
3080   6                                         return;
3081   6                                       }
3082   5                                       else nba_oth_dis();
3083   5                                       break;
3084   5                         } 
3085   4                                 if(EA) {TR0=TR1=EA=0;break;}
3086   4                         if(!EA&resu[4]!=0){ EA=TR0=1;if(resu[0]==1) TR1=1;}
3087   4                                 break;                                                                                                                
3088   4                case 10:
3089   4                case 11:
3090   4                         if(!EA)                      // ÔÝÍ£×´Ì¬ÏÂ ok¼üÁ½´Î·µ»ØÊ±ÖÓ½çÃæ
3091   4                                 {                //  ./s ¼üÁ½´ÎÍË³ö
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 51  

3092   5                                   delay(6000);
3093   5                                       save=gotkey();
3094   5                                       if(save==key)
3095   5                                       {
3096   6                                         if(key==11)
3097   6                                         {
3098   7                                           clear_dis();oth_run=1;
3099   7                                           rds1302_time();
3100   7                                               init_d2=1;
3101   7                                           dis_mode2();
3102   7                                               init_d2=0;
3103   7                                           while(gotkey()!=11);
3104   7                                           oth_run=0;
3105   7                                               save=110;
3106   7                                           clear_dis();
3107   7                                           nba_oth_dis();
3108   7                                         }
3109   6                                         else{ signs=r1302(d02_signs+1); nba_tim=0;return;}
3110   6                                   }
3111   5                                       else{ key=save;goto ss;}
3112   5                                 }
3113   4                                 break;         
3114   4              }
3115   3              if(save==110)  break;
3116   3          }while(1);  
3117   2        }  
3118   1      }
3119          
3120                   
3121          /*=====================================================================================
3122           º¯ÊýÃû³Æ£ºÉèÖÃ¹¦ÄÜ
3123           ¹¦ÄÜÃèÊö£ºÏµÍ³×´Ì¬ÉèÖÃ  
3124           È«¾Ö±äÁ¿£ºsigns
3125           ²ÎÊýËµÃ÷£º¼ûº¯Êý
3126           ·µ»ØËµÃ÷£ºÎÞ
3127           Éè ¼Æ ÈË£ºLIJH
3128           °æ    ±¾£º1.0
3129           Ëµ    Ã÷£º
3130           ======================================================================================*/
3131          
3132          
3133          /*ÉèÖÃµ÷ÕûÄÚÈÝ ²ÎÊý¸ñÊ½£ºÑ¡ÖÐÉèÖÃÏî£¬ÉèÖÃÏî×ÓÖµ*/
3134          uchar set_dis(uchar menu,uchar sub)
3135          {
3136   1        uchar save;
3137   1        con_disp(0xff,0xff,0x8e,0x80,2,16);
3138   1        con_disp(0x00,0x00,0x8a,0x80,4,16);
3139   1        display_cnasc(0x96,1,"\x1e ");
3140   1        display_cnasc(0x9e,1,"\x1f ");
3141   1        display_cnasc(0x92,1,"  ");
3142   1        display_cnasc(0x9a,1,"  ");
3143   1        display_cnasc(0x8d,1,"\x11 ");
3144   1        display_cnasc(0x8a,1,"  ");
3145   1        while(1)
3146   1        {
3147   2          
3148   2          if(menu<2)
3149   2            display_cnasc(0x8e,2,set_bl_dm[menu][sub]);
3150   2          else
3151   2                display_cnasc(0x8e,2,set_mka[menu-2][sub]);
3152   2              save=gotkey();
3153   2              if(save==5)
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 52  

3154   2              {
3155   3                key_dis(0x96);
3156   3                if(sub==0&&menu<2) sub=2;
3157   3                else if(sub==0&&menu>1) sub=1;
3158   3                else sub--;
3159   3          }
3160   2              if(save==2)
3161   2              {
3162   3                key_dis(0x9e);
3163   3                if(sub==2&&menu<2) sub=0;
3164   3                else if(sub==1&&menu>1) sub=0;
3165   3                else sub++;
3166   3              }
3167   2              if(save==1||save==11)
3168   2              {
3169   3                display_cnasc(0x8d,1,"\x04 ");
3170   3              delay(30000);
3171   3                con_disp(0x00,0x00,0x8e,0x80,2,16);
3172   3            con_disp(0xff,0xff,0x8a,0x80,4,16);
3173   3            display_cnasc(0x92,1,"\x1e ");
3174   3            display_cnasc(0x9a,1,"\x1f ");
3175   3            display_cnasc(0x96,1,"  ");
3176   3            display_cnasc(0x9e,1,"  ");
3177   3                display_cnasc(0x8a,1,"¡¾");
3178   3                display_cnasc(0x8d,3,"¡¿\x10 \x04 ");
3179   3                return(sub);    // ·µ»ØÉèÖÃÖµ
3180   3              }
3181   2        }
3182   1      }
3183          
3184          
3185          /*ÉèÖÃµ÷Õû*/
3186          void set_func(void)
3187          {
3188   1        uchar d,key,save;
3189   1        display_cnasc(0x81,2,"ÉèÖÃ");
3190   1        dis_title();
3191   1        display_cnasc(0x88,8,selected[1]);
3192   1        con_disp(0xff,0xff,0x8a,0x80,4,16);
3193   1        save=d=0;
3194   1        do
3195   1        {       
3196   2              display_cnasc(0x93,2,set_menu[index_s[save].lnum]);
3197   2              display_cnasc(0x8b,2,set_menu[save]);
3198   2              display_cnasc(0x9b,2,set_menu[index_s[save].rnum]); 
3199   2              d=save;
3200   2              while(1)
3201   2              {
3202   3                key=gotkey();
3203   3                if(key==11||key==3){ enter_dis();break;}
3204   3                if(key==5){save=index_s[d].lnum;key_dis(0x92); break;}
3205   3                if(key==2){save=index_s[d].rnum;key_dis(0x9a); break;}
3206   3                if(key==1){ wds1302_data(d02_signs,signs); return;}
3207   3          }
3208   2              if(key==11||key==3)
3209   2              {
3210   3            save=0;
3211   3            for(key=0;key<2;key++)  //  ½øÐÐÁ½´Î±È½Ï Ê×´ÎÎªÏÖÊ±Öµ Æä´ÎÎªÉè¶¨ÖÃ¸ü¸Ä 
3212   3            {
3213   4              switch(d)
3214   4              {
3215   5                case 0: 
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 53  

3216   5                                if(key==1)
3217   5                                {
3218   6                                          bl0=bl1=0;
3219   6                                              if(save==1) bl0=1;
3220   6                                              if(save==2)     bl1=1;
3221   6                                }
3222   5                            else 
3223   5                                        {if(bl0) save=1; if(bl1) save=2;}
3224   5                                        if(bl1) lcd_bl=close;
3225   5                                        else lcd_bl=open;
3226   5                                    break;
3227   5                    case 1: 
3228   5                                if(key==1)
3229   5                                {
3230   6                                          di0=di1=0;
3231   6                                              if(save==1) di0=1;
3232   6                                              if(save==2)     di1=1;
3233   6                                }
3234   5                                    else {if(di0) save=1; if(di1) save=2;}
3235   5                                    break;
3236   5                    case 2: 
3237   5                                if(key==1) meu=(bit)save;
3238   5                            else {if(meu) save++;}          
3239   5                                    break;
3240   5                case 3: 
3241   5                                if(key==1) keb=(bit)save;
3242   5                            else{if(keb) save++;}           
3243   5                                    break;
3244   5                case 4: 
3245   5                                if(key==1) als=(bit)save;
3246   5                            else{if(als) save++;}           
3247   5                                    break;
3248   5                case 5: wds1302_data(d02_signs,signs);
3249   5                            return;
3250   5              }
3251   4              if(key==0) save=set_dis(d,save);
3252   4            }
3253   3                save=d;
3254   3              }
3255   2        }while(1);
3256   1      }
3257          
3258          
3259          /*=====================================================================================
3260           º¯ÊýÃû³Æ£º±£ÃÜ¹¦ÄÜ
3261           ¹¦ÄÜÃèÊö£ºÏµÍ³ÖØÉè  ÃÜÂëËø  ÃÜÂë¸ü¸Ä  
3262           È«¾Ö±äÁ¿£ºresu  
3263           ²ÎÊýËµÃ÷£º¼ûº¯Êý
3264           ·µ»ØËµÃ÷£ºÎÞ
3265           Éè ¼Æ ÈË£ºLIJH
3266           °æ    ±¾£º1.0
3267           Ëµ    Ã÷£º
3268           ======================================================================================*/
3269          
3270          
3271          /*ÃÜÂëÕûÀí*/
3272          void passwork_finish()
3273          {
3274   1        uchar i;
3275   1        for(i=0;i<6;i+=2)
3276   1        {
3277   2          resu[i]<<=4;
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 54  

3278   2              resu[i]+=resu[i+1];
3279   2        }
3280   1      }
3281          
3282          
3283          
3284          /*¶ÁÈ¡ÃÜÂë*/
3285          uchar input_passwork()
3286          {
3287   1        uchar i,save[2];
3288   1        save[0]=' ';
3289   1        display_cnasc(0x9d,3,"(./S)\x10");
3290   1        for(i=0;i<6;i++)
3291   1        {
3292   2          while(1)
3293   2              {
3294   3                resu[i]=gotkey();
3295   3                if(resu[i]>=0&&resu[i]<10) break;
3296   3                if(resu[i]==10) return 10;
3297   3              }
3298   2          save[1]=char_num[resu[i]];
3299   2              display_cnasc(0x89+i,1,save); 
3300   2              delay(20000);
3301   2              display_cnasc(0x89+i,1," *");
3302   2        }
3303   1        return 11;
3304   1      }
3305          
3306          
3307          
3308          /*ÃÜÂëÈ·ÈÏ*/
3309          void input_second_passwork()
3310          {
3311   1        uchar i,save[2];
3312   1        save[0]=' ';
3313   1        display_cnasc(0x89,6,"            ");
3314   1        for(i=0;i<6;i++)
3315   1        {    
3316   2              if(resu[i]!=gotkey())   break;
3317   2              save[1]=char_num[resu[i]];
3318   2              display_cnasc(0x89+i,1,save); 
3319   2              delay(20000);
3320   2              display_cnasc(0x89+i,1," *");
3321   2        }
3322   1        if(i!=6)
3323   1        {
3324   2          display_cnasc(0x89,6,"ÃÜÂë²»ÏàÍ¬£¡");
3325   2              delay(50000);
3326   2              display_cnasc(0x9a,6,"ÈÎÒâ¼ü \x10    ");
3327   2              while(gotkey()==0xf0);
3328   2              return;
3329   2        }
3330   1        else
3331   1        {
3332   2              passwork_finish();
3333   2              for(i=0;i<6;i+=2)
3334   2                wds1302_data(d02_passw+i,resu[i]);
3335   2              for(i=0;i<6;i+=2)
3336   2                if(resu[i]!=r1302(d02_passw+i+1)) break;
3337   2              if(i==6)
3338   2               {display_cnasc(0x98,8,"\x10 ¸ü¸Ä³É¹¦!(OK) ");
3339   3                while(gotkey()!=11);return;}
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 55  

3340   2              else
3341   2                display_cnasc(0x9a,6,"¸ü¸ÄÊ§°Ü£¡  ");
3342   2        }
3343   1        delay_pw();
3344   1      }                               
3345          
3346          
3347          
3348          /*ÃÜÂë±È½Ï*/
3349          uchar passwork_comp()
3350          {
3351   1        uchar i;
3352   1        passwork_finish();
3353   1        for(i=0;i<6;i+=2)
3354   1              if(resu[i]!=r1302(d02_passw+i+1)) break;
3355   1        if(i==6)       return 1;
3356   1        else
3357   1        { 
3358   2          display_cnasc(0x89,6,"  ÃÜÂë´íÎó£¡");
3359   2              delay_pw();
3360   2              display_cnasc(0x89,6,"            ");
3361   2              return 110;
3362   2        }
3363   1      }
3364          
3365          
3366          
3367          /*±£ÃÜµ¼º½*/
3368          void passw_func(void)
3369          {
3370   1        uchar save,d,key;
3371   1        d=0;save=0;
3372   1        do
3373   1        {
3374   2          clear_dis();
3375   2              display_cnasc(0x81,2,"±£ÃÜ");
3376   2          dis_title();
3377   2          display_cnasc(0x88,8,selected[0]);
3378   2          con_disp(0xff,0xff,0x8a,0x80,5,16); 
3379   2          do
3380   2          {     
3381   3                display_cnasc(0x93,3,secrets_menu[index_p[save].lnum]);
3382   3                display_cnasc(0x8b,3,secrets_menu[save]);
3383   3                display_cnasc(0x9b,3,secrets_menu[index_p[save].rnum]);  
3384   3                d=save;
3385   3                while(1)
3386   3                {
3387   4                  key=gotkey();
3388   4                  if(key==11||key==3){enter_dis();break;}
3389   4                  if(key==2){save=index_p[d].rnum; key_dis(0x9a);break;}
3390   4                  if(key==5){save=index_p[d].lnum; key_dis(0x92);break;}
3391   4                      if(key==1){return;}
3392   4            }
3393   3            if(key==11||key==3)
3394   3                {     
3395   4                      if(d==3) return;                
3396   4                      clear_dis();
3397   4                      dis_title_e();
3398   4              switch(d)
3399   4              {
3400   5                case 0: 
3401   5                                display_cnasc(0x82,3,"ÃÜÂëËø");
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 56  

3402   5                                        display_cnasc(0x90,5,"ÊäÈëÃÜÂë£º");
3403   5                                        while(1)
3404   5                                        {
3405   6                                          key=input_passwork();
3406   6                                          if(key==10) break;
3407   6                                          key=passwork_comp();
3408   6                                          if(key==1) 
3409   6                                  {
3410   7                                            display_cnasc(0x90,8,"´¦¿ªÆô×´Ì¬£¬°´¼ü");
3411   7                                    display_cnasc(0x88,8,"¡õ1-³£¿ª¡õ2-¹Ø±Õ");
3412   7                                            display_cnasc(0x98,8,"¡ö×Ô¶¯ÑÓÊ±30Ãë  ");
3413   7                                                pw_oc=open;
3414   7                                            save1=i=0;   
3415   7                                            lock_op=1;   // ¿ªÆô±ê¼ÇµÈ´ýÑÓÊ±
3416   7                                            while(1)
3417   7                                            {
3418   8                                                  key=gotkey(); // ·µ»Ø255ÎªÑÓÊ±Ê±¼äµ½´ï
3419   8                                                  if(key==255){ lock_op=0;pw_oc=close;break;}
3420   8                                                  if(key==1) 
3421   8                                                  {
3422   9                                                    display_cnasc(0x88,1,"¡ö");
3423   9                                                    display_cnasc(0x98,1,"¡õ");
3424   9                                                    lock_op=0;
3425   9                                                  }
3426   8                                                  if(key==2)
3427   8                                                  {
3428   9                                                    display_cnasc(0x88,1,"¡õ");
3429   9                                                        display_cnasc(0x98,1,"¡õ");
3430   9                                                        display_cnasc(0x8c,1,"¡ö");
3431   9                                                        delay(60000);
3432   9                                                        clear_dis();
3433   9                                                    dis_title_e();
3434   9                                        display_cnasc(0x82,3,"ÃÜÂëËø");
3435   9                                                    display_cnasc(0x90,5,"ÃÜÂëËø½«ÔÚ");
3436   9                                                        display_cnasc(0x8a,6," 5Ãëºó¹Ø±Õ£º");
3437   9                                                    for(save=0;save<5;save++)
3438   9                                                    { 
3439  10                                                      display_cnasc(0x99+save,1,"¡ú"); 
3440  10                                                          delay_pw();
3441  10                                                    }
3442   9                                                        display_cnasc(0x9e,1,"¡Ì");
3443   9                                                        pw_oc=open;
3444   9                                                        delay(30000);
3445   9                                                        pw_oc=close;
3446   9                                                    lock_op=0;
3447   9                                                    break;
3448   9                                                  }
3449   8                                            }
3450   7                                                break;
3451   7                                          }
3452   6                                        } 
3453   5                                    break;
3454   5                    case 1: 
3455   5                                display_cnasc(0x82,3,"¸ü  ¸Ä");
3456   5                                        display_cnasc(0x90,6,"ÊäÈë¾ÉÃÜÂë£º");
3457   5                                        while(1)
3458   5                                        {
3459   6                                          key=input_passwork();
3460   6                                          if(key==10) break;
3461   6                                          key=passwork_comp();
3462   6                                          if(key==1)
3463   6                                          {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 57  

3464   7                                            display_cnasc(0x92,1,"ÐÂ");
3465   7                                                display_cnasc(0x89,6,"            ");
3466   7                                            key=input_passwork();
3467   7                                                if(key==10) break;
3468   7                                                display_cnasc(0x90,6,"È·ÈÏÃÜÂë£º  ");
3469   7                                                input_second_passwork();
3470   7                                                break;                
3471   7                                          }
3472   6                                        }
3473   5                                        break;
3474   5                    case 2: 
3475   5                                display_cnasc(0x82,3,"³õÊ¼»¯");
3476   5                                display_cnasc(0x91,6,"ÊÇ·ñ³õÊ¼»¯? ");
3477   5                        display_cnasc(0x89,6,"Y(OK)\\N(./S)");
3478   5                                        while(1)
3479   5                                        {
3480   6                                          key=gotkey();
3481   6                                              if(key==11)
3482   6                                              {
3483   7                                                clear_dis();
3484   7                                                dis_title_e();
3485   7                                                display_cnasc(0x82,3,"³õÊ¼»¯");
3486   7                                                display_cnasc(0x90,5,"ÊäÈëÃÜÂë£º");
3487   7                                                do
3488   7                                                {
3489   8                                                  key=input_passwork();
3490   8                                                  if(key==10) break;
3491   8                                                  key=passwork_comp();
3492   8                                                  if(key==1)
3493   8                                                  {
3494   9                                                        display_cnasc(0x90,5,"ÃÜÂëÕýÈ·£¡");
3495   9                                                        display_cnasc(0x89,7,"\x10 ³õÊ¼»¯ÖÐ... ");
3496   9                                                        init_ds1302();
3497   9                                                        rds1302_data();
3498   9                                                        delay_pw();
3499   9                                                        display_cnasc(0x9a,6,"\x10 Íê³É£¡(OK)");
3500   9                                                        while(gotkey()!=11);
3501   9                                                        key=10;
3502   9                                                        break;
3503   9                                                  }
3504   8                                                }while(1);
3505   7                                              }
3506   6                                              if(key==10) break;
3507   6                                        }
3508   5                                        break;
3509   5                      }
3510   4                      key=99;save=d;
3511   4                }
3512   3                if(key==99) break;
3513   3              }while(1);
3514   2        }while(1);
3515   1      }
3516          
3517          
3518          /*=====================================================================================
3519           º¯ÊýÃû³Æ£º°æ±¾ÐÅÏ¢
3520           ¹¦ÄÜÃèÊö£º  
3521           È«¾Ö±äÁ¿£º
3522           ²ÎÊýËµÃ÷£º¼ûº¯Êý
3523           ·µ»ØËµÃ÷£ºÎÞ
3524           Éè ¼Æ ÈË£ºLIJH
3525           °æ    ±¾£º1.0
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 58  

3526           Ëµ    Ã÷£º
3527           ======================================================================================*/
3528          
3529          void version_func(void)
3530          {
3531   1        uchar save,v=0;
3532   1        display_cnasc(0x82,3,"°æ  ±¾");
3533   1        dis_title_e();
3534   1        do
3535   1        {
3536   2              display_cnasc(0x90,7,version[v]);
3537   2              display_cnasc(0x88,7,version[v+1]);
3538   2              display_cnasc(0x98,7,version[v+2]);
3539   2              if(v!=0) display_cnasc(0x97,1," \x1e");
3540   2              else if(v==0)
3541   2                display_cnasc(0x97,1,"Ôº"); 
3542   2              else display_cnasc(0x97,1,"  ");
3543   2              if(v!=7) display_cnasc(0x9f,1," \x1f");
3544   2              else display_cnasc(0x9f,1,"  ");
3545   2              save=gotkey();
3546   2              if(save==2&&v<7)
3547   2              {
3548   3                display_cnasc(0x9f,1," \x04");
3549   3            delay(30000);
3550   3                v++;
3551   3              }
3552   2              if(save==5&&v>0)
3553   2              {
3554   3                display_cnasc(0x97,1," \x04");
3555   3            delay(30000);
3556   3                v--;
3557   3              }
3558   2              if(save==1) return;
3559   2              if((save==11||save==3)&&v==7) 
3560   2              {
3561   3                display_cnasc(0x9e,2,") \x09 ");
3562   3            delay(30000);
3563   3                return;         
3564   3              }
3565   2        }while(1);
3566   1      }
3567          
3568          
3569          
3570          /*=====================================================================================
3571           º¯ÊýÃû³Æ£ºÏµÍ³Ö÷º¯Êý
3572           ¹¦ÄÜÃèÊö£º  
3573           È«¾Ö±äÁ¿£º
3574           ²ÎÊýËµÃ÷£º¼ûº¯Êý
3575           ·µ»ØËµÃ÷£ºÎÞ
3576           Éè ¼Æ ÈË£ºLIJH
3577           °æ    ±¾£º1.0
3578           Ëµ    Ã÷£º
3579           ======================================================================================*/
3580          main()
3581          {
3582   1        uchar key;                                                     
3583   1        init_lcd();                                             // ³õÊ¼»¯lcd
3584   1        lcd_bl=als_tl=als_th=buzzer=pw_oc=close;
3585   1        key=r1302(d02_initsi+1);            // ¶Á³ö1302³õÊ¼»¯±ê¼ÇÎ»
3586   1        if(bl1) lcd_bl=close;
3587   1        else lcd_bl=open;
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 59  

3588   1        display_cnasc(0x92,4,"»¶Ó­Ê¹ÓÃ");   // ÏÔÊ¾¿ª»ú»­Ãæ¡°»¶Ó­Ê¹ÓÃ¡±
3589   1        display_cnasc(0x9d,3,"¡ªLiJH");
3590   1        if(key!=0xb4)  init_ds1302();       // DS1302³õÊ¼»¯
3591   1        rds1302_data();                                         // ¿ª»ú¶Á»ØÉèÖÃÊý¾Ý
3592   1        rds1302_date();
3593   1        rds1302_time();                     // ¶ÁÈÕÆÚÊ±¼ä   
3594   1        if(!ds18b20) init_ds18b20();            // ³õÊ¼»¯18b20
3595   1        if(ds18b20) 
3596   1        {                                          
3597   2              ds18b20_func();                                    // ¶Á³öÎÂ¶È
3598   2        } 
3599   1        time_init();                         // ¶¨Ê±Æ÷³õÊ¼»¯
3600   1        delay_pw();resu[11]=0; 
3601   1        while(1)
3602   1        {  
3603   2              EA=1;
3604   2              TR0=1;
3605   2              dis_sig=1;      
3606   2              clear_dis();
3607   2              if(di0){init_d2=1;dis_mode2();init_d2=0;}
3608   2          else if(di1) dis_mode3();
3609   2          else dis_mode1();   
3610   2              do
3611   2              {
3612   3                key=gotkey();
3613   3                if(key==255)                  // ¼üÅÌÃÜÂëÊäÈë
3614   3                {
3615   4                      TR0=0;
3616   4                      dis_sig=0;
3617   4                      clear_dis();
3618   4                      dis_title_e();
3619   4                      display_cnasc(0x82,3,"¼üÅÌËø");
3620   4                      display_cnasc(0x90,5,"ÊäÈëÃÜÂë£º");
3621   4                      while(1)
3622   4                      {
3623   5                        keb=0;
3624   5                        key=input_passwork();
3625   5                        if(key==10) {keb=1;resu[11]=2;break;}
3626   5                        key=passwork_comp();
3627   5                        if(key==1) {keb=1;resu[11]=0;break;}    
3628   5                      }
3629   4                      rds1302_date();
3630   4              rds1302_time();
3631   4                  save_time=now;
3632   4                      break;
3633   4                }
3634   3                if(key==11)
3635   3                {
3636   4                  dis_menu_key(1);
3637   4                      delay(35000);
3638   4                      do
3639   4                      {
3640   5                        dis_sig=0;
3641   5                        TR0=0;
3642   5                        clear_dis();
3643   5                        key=dis_menu();
3644   5                        clear_dis();
3645   5                        if(key==0) adjust_func();
3646   5                        else if(key==1) // µ÷ÓÃÏàÓ¦³ÌÐò¹¦ÄÜS
3647   5                        {
3648   6                          while(1)
3649   6                              {
C51 COMPILER V9.00   ¿Ø_ÆÏµÍ³                                                              07/21/2010 11:00:34 PAGE 60  

3650   7                                clear_dis();
3651   7                            key=tool_func();
3652   7                                if(key==4) break;
3653   7                                clear_dis(); 
3654   7                                switch(key)
3655   7                                {
3656   8                                  case 0:     calculator();
3657   8                                              break;
3658   8                                      case 1: temp_func();
3659   8                                              break;
3660   8                                      case 2: alarm_func();
3661   8                                              break;
3662   8                                      case 3: nba_timer();
3663   8                                              break;
3664   8                                }
3665   7                              }
3666   6                        }
3667   5                        else if(key==2)       set_func();
3668   5                        else if(key==3)       passw_func();
3669   5                        else if(key==4) version_func();
3670   5                        else
3671   5                        {
3672   6                          rds1302_date();
3673   6                  rds1302_time();
3674   6                              save_time=now;
3675   6                              resu[11]=0;
3676   6                              dis_sig=1;
3677   6                              break;
3678   6                        }
3679   5                      }while(1);
3680   4                }
3681   3                if(dis_sig) break;
3682   3              }while(1);
3683   2        }
3684   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =  15214    ----
   CONSTANT SIZE    =   4065    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5     121
   IDATA SIZE       =     58    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
